commit 962a37b29d46cd24265cf92ab1528cc5ca486fa1
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jul 25 15:25:34 2014 +0200

    Initial work towards removing require.js

diff --git a/.jshintignore b/.jshintignore
index 884c3bb8c1..42c40653e3 100644
--- a/.jshintignore
+++ b/.jshintignore
@@ -2,13 +2,6 @@ tests/
 src/sentry/static/sentry/bootstrap/
 src/sentry/static/sentry/scripts/lib/
 src/sentry/static/CACHE/
-src/sentry/static/sentry/scripts/legacy.min.js
-src/sentry/static/sentry/scripts/legacy.map.js
-src/sentry/static/sentry/scripts/global.min.js
-src/sentry/static/sentry/scripts/global.map.js
-src/sentry/static/sentry/scripts/lib.min.js
-src/sentry/static/sentry/scripts/lib.map.js
-src/sentry/static/sentry/scripts/bootstrap.js
-src/sentry/static/sentry/scripts/bootstrap.min.js
-src/sentry/static/sentry/scripts/bootstrap.map.js
+src/sentry/static/sentry/app.min.js
+src/sentry/static/sentry/legacy-app.min.js
 src/sentry/static/sentry/vendor/
diff --git a/.jshintrc b/.jshintrc
index fb434c7cef..9e37518fc4 100644
--- a/.jshintrc
+++ b/.jshintrc
@@ -2,8 +2,6 @@
     "strict": true,
     "browser": true,
     "predef": [
-        "parseUri",
-        "requirejs",
-        "define"
+        "angular"
     ]
 }
diff --git a/bower.json b/bower.json
index 80946e9f3c..db5e590423 100644
--- a/bower.json
+++ b/bower.json
@@ -6,8 +6,6 @@
   },
   "private": true,
   "dependencies": {
-    "d3": "~3.4.2",
-    "d3-tip": "https://github.com/deciob/d3-tip.git#amd",
     "angular": "1.2.9",
     "angular-bootstrap": "~0.10.0",
     "angular-classy": "~0.4.2",
@@ -25,8 +23,6 @@
     "jquery": "~2.0.3",
     "jquery-flot": "~0.8.3",
     "json2": "*",
-    "requirejs": "2.1.11",
-    "requirejs-plugins": "~1.0.2",
     "selectize": "~0.10.1",
     "simple-slider": "https://github.com/loopj/jquery-simple-slider.git"
   }
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index e68a9f4114..17d30ac716 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -410,6 +410,88 @@ SENTRY_STATIC_BUNDLES = {
                 "sentry/less/wall.less": "sentry/styles/wall.css",
             },
         },
+
+        "sentry/app.min.js": {
+            "src": [
+                "sentry/app/modules/charts.js",
+                "sentry/app/modules/collection.js",
+                "sentry/app/modules/forms.js",
+
+                "sentry/app/controllers/default.js",
+                "sentry/app/controllers/deleteTeam.js",
+                "sentry/app/controllers/groupDetails.js",
+                "sentry/app/controllers/manageTeamOwnership.js",
+                "sentry/app/controllers/manageTeamSettings.js",
+                "sentry/app/controllers/projectStream.js",
+                "sentry/app/controllers/teamDashboard.js",
+
+                "sentry/app/directives/count.js",
+                "sentry/app/directives/timeSince.js",
+
+                "sentry/app.js",
+            ],
+        },
+
+        # TODO(dcramer): this needs to go away ASAP
+        "sentry/legacy-app.min.js": {
+            "src": [
+                "sentry/vendor/json2/json2.js",
+                "sentry/vendor/underscore/underscore.js",
+                "sentry/vendor/backbone/backbone.js",
+
+                "sentry/app/init.js",
+
+                "sentry/app/base.js",
+                "sentry/app/charts.js",
+                "sentry/app/collections.js",
+                "sentry/app/models.js",
+                "sentry/app/templates.js",
+                "sentry/app/views.js",
+                "sentry/app/utils.js",
+            ],
+        },
+
+        "sentry/vendor-angular.min.js": {
+            "src": [
+                "sentry/vendor/angular/angular.min.js",
+                # "sentry/vendor/angular-route/angular-route.min.js",
+
+                "sentry/vendor/angular-bootstrap/ui-bootstrap-tpls.min.js",
+                "sentry/vendor/angular-classy/angular-classy.min.js",
+                # "sentry/vendor/angular-http-auth/src/http-auth-interceptor.js",
+
+                "sentry/vendor/angular-loading-bar/build/loading-bar.min.js",
+            ],
+        },
+
+        "sentry/vendor-bootstrap.min.js": {
+            "src": [
+                "sentry/vendor/bootstrap/dist/js/bootstrap.min.js",
+                "sentry/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js",
+            ],
+        },
+
+        "sentry/vendor-jquery.min.js": {
+            "src": [
+                "sentry/vendor/jquery/jquery.min.js",
+                "sentry/scripts/lib/jquery.clippy.min.js",
+                "sentry/scripts/lib/jquery.cookie.js",
+                "sentry/vendor/jquery-flot/jquery.flot.js",
+                "sentry/scripts/lib/jquery.flot.dashes.js",
+                "sentry/vendor/jquery-flot/jquery.flot.resize.js",
+                "sentry/vendor/jquery-flot/jquery.flot.time.js",
+                "sentry/scripts/lib/jquery.flot.tooltip.js",
+            ],
+        },
+
+        "sentry/vendor-misc.min.js": {
+            "src": [
+                "sentry/vendor/moment/min/moment.min.js",
+                "sentry/vendor/selectize/dist/js/standalone/selectize.min.js",
+                "sentry/vendor/simple-slider/js/simple-slider.min.js",
+            ],
+        },
+
     },
     "postcompilers": {
         "*.js": ["node_modules/.bin/uglifyjs {input} --source-map-root={relroot}/ --source-map-url={name}.map{ext} --source-map={relpath}/{name}.map{ext} -o {output}"],
diff --git a/src/sentry/static/sentry/app.js b/src/sentry/static/sentry/app.js
index ca96d2a1e9..bab66481fa 100644
--- a/src/sentry/static/sentry/app.js
+++ b/src/sentry/static/sentry/app.js
@@ -1,24 +1,36 @@
-define([
-  'angular',
-  'ngBootstrap',
-  'ngClassy',
+var SentryApp = angular.module('app', [
+  'classy',
 
-  'moment',
-  'jquery',
-  'selectize',
+  'sentry.charts',
+  'sentry.collection',
+  'sentry.forms',
 
-  'app/modules/charts',
-  'app/modules/collection',
-  'app/modules/forms'
+  'sentry.controllers.default',
+  'sentry.controllers.deleteTeam',
+  'sentry.controllers.groupDetails',
+  'sentry.controllers.manageTeamOwnership',
+  'sentry.controllers.manageTeamSettings',
+  'sentry.controllers.projectStream',
+  'sentry.controllers.teamDashboard',
 
-], function(angular){
+  'sentry.directives.count',
+  'sentry.directives.timeSince',
+
+  'ui.bootstrap'
+]).config(function(
+  $httpProvider, $interpolateProvider, $provide
+) {
   'use strict';
 
-  return angular.module('app', [
-    'classy',
-    'sentry.charts',
-    'sentry.collection',
-    'sentry.forms',
-    'ui.bootstrap'
-  ]);
+  // compatiblity with Django templates
+  $interpolateProvider.startSymbol('<%');
+  $interpolateProvider.endSymbol('%>');
+
+  // add in Django csrf support
+  $httpProvider.defaults.xsrfCookieName = 'csrftoken';
+  $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
+
+  $provide.value('config', window.SentryConfig);
+  $provide.value('selectedTeam', window.SentryConfig.selectedTeam);
+  $provide.value('selectedProject', window.SentryConfig.selectedProject);
 });
diff --git a/src/sentry/static/sentry/app.min.js b/src/sentry/static/sentry/app.min.js
new file mode 100644
index 0000000000..7314294770
--- /dev/null
+++ b/src/sentry/static/sentry/app.min.js
@@ -0,0 +1,2 @@
+(function(){"use strict";var average=function(a){var r={mean:0,variance:0,deviation:0},t=a.length;for(var m,s=0,l=t;l--;s+=a[l]);for(m=r.mean=s/t,l=t,s=0;l--;s+=Math.pow(a[l]-m,2));r.deviation=Math.sqrt(r.variance=s/t);return r};var percentile=function(a,nth){a=a.sort();a.slice(0,a.length-Math.floor(nth/a.length));return average(a)};var timeUnitSize={second:1e3,minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,quarter:3*30*24*60*60*1e3,year:365.2425*24*60*60*1e3};var tickFormatter=function(value,axis){var d=moment(value);var t=axis.tickSize[0]*timeUnitSize[axis.tickSize[1]];var span=axis.max-axis.min;var fmt;if(t<timeUnitSize.minute){fmt="LT"}else if(t<timeUnitSize.day){fmt="LT";if(span<2*timeUnitSize.day){fmt="LT"}else{fmt="MMM D LT"}}else if(t<timeUnitSize.month){fmt="MMM D"}else if(t<timeUnitSize.year){if(span<timeUnitSize.year){fmt="MMM"}else{fmt="MMM YY"}}else{fmt="YY"}return d.format(fmt)};function createBasicChart(el,url){$.ajax({url:url,type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-3600*24*7,resolution:"1h"},success:function(data){var inputs=[],avg,i,data_avg=[],p_95th,max_y=10;for(i=0;i<data.length;i++){inputs.push(data[i][1]);data[i][0]=data[i][0]*1e3;if(data[i][1]>max_y){max_y=data[i][1]}}p_95th=percentile(inputs);for(i=0;i<data.length;i++){data_avg.push([data[i][0],p_95th.mean])}var points=[{data:data,color:"rgba(86, 175, 232, 1)",shadowSize:0,lines:{lineWidth:2,show:true,fill:false}},{data:data_avg,color:"rgba(244, 63, 32, .4)",shadowSize:0,dashes:{lineWidth:2,show:true,fill:false}}];var options={xaxis:{mode:"time",tickFormatter:tickFormatter},yaxis:{min:0,max:max_y,tickFormatter:function(value){if(value>999999){return value/1e6+"mm"}if(value>999){return value/1e3+"k"}return value}},tooltip:true,tooltipOpts:{content:function(label,xval,yval,flotItem){return yval+" events<br>"+moment(xval).format("llll")},defaultTheme:false},grid:{show:true,hoverable:true,backgroundColor:"#ffffff",borderColor:"#DEE3E9",borderWidth:2,tickColor:"#DEE3E9"},hoverable:false,legend:{noColumns:5},lines:{show:false}};$.plot(el,points,options);$(window).resize(function(){$.plot(el,points,options)})}})}angular.module("sentry.charts",[]).directive("simpleChart",function(){return function(scope,element,attrs){createBasicChart(element,attrs.simpleChart)}})})();(function(){"use strict";angular.module("sentry.collection",[]).factory("Collection",function(){var defaults={sortFunc:null,limit:null};function Collection(collection,options){var i;Array.call(this);if(options===undefined){options={}}for(i in defaults){if(options[i]===undefined){options[i]=defaults[i]}}this.options=options;if(collection!==undefined){for(i=0;i<collection.length;i++){this.push(collection[i])}}return this}Collection.prototype=[];Collection.prototype.constructor=Collection;Collection.prototype.push=function push(item){if(this._updateExisting(item)){return}Array.prototype.push.apply(this,arguments);if(this.options.sortFunc){this.options.sortFunc(this)}if(this.options.limit&&this.length>this.options.limit){this.splice(this.options.limit,this.length-this.options.limit)}};Collection.prototype.unshift=function unshift(item){if(this._updateExisting(item)){return}Array.prototype.unshift.apply(this,arguments);if(this.options.sortFunc){this.options.sortFunc(this)}if(this.options.limit&&this.length>this.options.limit){this.splice(this.options.limit,this.length-this.options.limit)}};Collection.prototype.remove=function remove(item){for(var i=0;i<this.length;i++){if(this[i].id==item.id){this.splice(i,i+1);return}}};Collection.prototype._updateExisting=function _updateExisting(item){for(var i=0;i<this.length;i++){if(this[i].id==item.id){angular.extend(this[i],item);return true}}return false};return Collection})})();(function(){"use strict";var TEMPLATES={text:"input-text.html",select:"input-select.html"};var DEFAULT_TEMPLATE=TEMPLATES.text;function titleize(string){string=string.replace("_"," ");return string.charAt(0).toUpperCase()+string.slice(1)}angular.module("sentry.forms",[]).factory("Form",function(){var Form=function(fields,initial){var field,fieldName;this._data=angular.copy(initial||{});this._fields=fields;for(fieldName in fields){field=fields[fieldName];field.name=fieldName;field.value=this._data[fieldName];field.label=field.label||titleize(field.name);field.required=field.required||false;this[fieldName]=field}};Form.prototype.isUnchanged=function(){var data={},field,fieldName;for(fieldName in this._fields){field=this._fields[fieldName];if(field.value!=this._data[fieldName]){return false}}return true};Form.prototype.getData=function(){var data={},fieldName;for(fieldName in this._fields){data[fieldName]=this._fields[fieldName].value}return data};Form.prototype.setData=function(data){var fieldName;this._data=data;for(fieldName in this._fields){this._fields[fieldName].value=data[fieldName]||""}};return Form}).directive("formField",function(){return{restrict:"A",template:'<div ng-include="fieldTemplateUrl"></div>',scope:{formField:"="},link:function(scope,element,attrs,ctrl){var field=scope.formField;var templateName=TEMPLATES[field.type]||DEFAULT_TEMPLATE;scope.fieldTemplateUrl="templates/forms/"+templateName;scope.field=field}}})})();(function(){"use strict";angular.module("sentry.controllers.default",["classy"]).classy.controller({name:"DefaultCtrl"})})();(function(){"use strict";angular.module("sentry.controllers.deleteTeam",["classy"]).classy.controller({name:"DeleteTeamCtrl",inject:["$scope","$http","selectedTeam"],init:function(){var $scope=this.$scope;$scope.newOwner=null;this.$http.get("/api/0/teams/"+this.selectedTeam.id+"/projects/").success(function(data){$scope.projectList=data})},saveForm:function(){this.$http({method:"DELETE",url:"/api/0/teams/"+this.selectedTeam.id+"/"}).success(function(data){window.location.href="/"})}})})();(function(){"use strict";angular.module("sentry.controllers.groupDetails",["classy"]).classy.controller({name:"GroupDetailsCtrl",inject:["$scope","$http"],init:function(){this.$http.post("/api/0/groups/"+window.SentryConfig.selectedGroup.id+"/markseen/")}})})();(function(){"use strict";angular.module("sentry.controllers.manageTeamOwnership",["classy"]).classy.controller({name:"ManageTeamOwnershipCtrl",inject:["$scope","$http","selectedTeam"],init:function(){this.$scope.newOwner=null},isUnchanged:function(value){return value===null},saveForm:function(){this.$http.put("/api/0/teams/"+this.selectedTeam.id+"/",{owner:this.$scope.newOwner}).success(function(data){window.location.href="/"})}})})();(function(){"use strict";angular.module("sentry.controllers.manageTeamSettings",["classy"]).classy.controller({name:"ManageTeamSettingsCtrl",inject:["$scope","$http","selectedTeam"],init:function(){this.$scope.teamData={name:this.selectedTeam.name,slug:this.selectedTeam.slug}},isUnchanged:function(){for(var name in this.$scope.teamData){if(this.selectedTeam[name]!=this.$scope.teamData[name]){return false}}return true},saveForm:function(){this.$http.put("/api/0/teams/"+this.selectedTeam.id+"/",this.$scope.teamData).success(function(data){window.location.href="/account/teams/"+data.slug+"/settings"})}})})();(function(){"use strict";angular.module("sentry.controllers.projectStream",["classy"]).classy.controller({name:"ProjectStreamCtrl",inject:["Collection","selectedProject","$http","$scope","$window","$timeout"],init:function(){this.$scope.groupList=new this.Collection(this.$window.groupList);this.$timeout(this.pollForChanges,1e3);this.setChartDuration("1d")},setChartDuration:function(duration){this.$scope.chartDuration=duration;$.each(this.$scope.groupList,function(_,group){group.activeChartData=group.stats["24h"]})},pollForChanges:function(){var self=this;this.$http.get("/api/0/projects/"+this.selectedProject.id+"/groups/").success(function(data){for(var i=0;i<data.length;i++){self.$scope.groupList.unshift(data[i])}utils.sortArray(self.$scope.groupList,function(item){return[new Date(item.lastSeen).getTime()]}).splice(50)}).finally(function(){self.$timeout(self.pollForChanges,1e3)})}})})();(function(){"use strict";angular.module("sentry.controllers.teamDashboard",["classy"]).classy.controller({name:"TeamDashboardCtrl",init:function(){}})})();(function(){"use strict";var numberFormats=[[1e9,"b"],[1e6,"m"],[1e3,"k"]];var floatFormat=function(number,places){var multi=Math.pow(10,places);return parseInt(number*multi,10)/multi};var formatNumber=function(number){var b,x,y,o,p;number=parseInt(number,10);for(var i=0;b=numberFormats[i];i++){x=b[0];y=b[1];o=Math.floor(number/x);p=number%x;if(o>0){if(o/10>1||!p)return""+o+y;return""+floatFormat(number/x,1)+y}}return""+number};angular.module("sentry.directives.count",[]).directive("count",function(){return function(scope,element,attrs){var value=scope.$eval(attrs.count);if(value===undefined){element.text("")}else{element.text(formatNumber(value))}}})})();(function(){"use strict";angular.module("sentry.directives.timeSince",[]).directive("timeSince",["$timeout",function($timeout){return function timeSince(scope,element,attrs){var timeout_id;function update(value){if(!value||value===undefined){return""}element.text(moment.utc(value).fromNow())}function tick(){update(scope.$eval(attrs.timeSince));timeout_id=$timeout(tick,1e3)}scope.$watch(attrs.timeSince,update);element.bind("$destroy",function(){if(timeout_id){$timeout.cancel(timeout_id)}});tick()}}])})();var SentryApp=angular.module("app",["classy","sentry.charts","sentry.collection","sentry.forms","sentry.controllers.default","sentry.controllers.deleteTeam","sentry.controllers.groupDetails","sentry.controllers.manageTeamOwnership","sentry.controllers.manageTeamSettings","sentry.controllers.projectStream","sentry.controllers.teamDashboard","sentry.directives.count","sentry.directives.timeSince","ui.bootstrap"]).config(function($httpProvider,$interpolateProvider,$provide){"use strict";$interpolateProvider.startSymbol("<%");$interpolateProvider.endSymbol("%>");$httpProvider.defaults.xsrfCookieName="csrftoken";$httpProvider.defaults.xsrfHeaderName="X-CSRFToken";$provide.value("config",window.SentryConfig);$provide.value("selectedTeam",window.SentryConfig.selectedTeam);$provide.value("selectedProject",window.SentryConfig.selectedProject)});
+//@ sourceMappingURL=app.min.map.js
\ No newline at end of file
diff --git a/src/sentry/static/sentry/app/base.js b/src/sentry/static/sentry/app/base.js
index f617bffcb5..e359f90fb5 100644
--- a/src/sentry/static/sentry/app/base.js
+++ b/src/sentry/static/sentry/app/base.js
@@ -1,18 +1,8 @@
-define([
-    'backbone',
-    'jquery',
-    'underscore',
-
-    'app/charts',
-    'app/config',
-    'app/models',
-    'app/utils',
-    'app/views',
-
-    'simple-slider'
-], function(Backbone, $, _, appCharts, appConfig, appModels, appUtils, appViews){
+(function(){
     'use strict';
 
+    var appConfig = window.SentryConfig;
+
     var BasePage = Backbone.View.extend({
 
         defaults: {
@@ -70,13 +60,13 @@ define([
         },
 
         makeDefaultView: function(id){
-            return new appViews.GroupListView({
+            return new app.views.GroupListView({
                 className: 'events small',
                 id: id,
                 maxItems: 5,
                 stream: this.options.stream,
                 realtime: this.options.realtime,
-                model: appModels.Group
+                model: app.models.Group
             });
         },
 
@@ -90,7 +80,7 @@ define([
 
     });
 
-    return {
+    $.extend(app, {
         BasePage: BasePage,
 
         StreamPage: BasePage.extend({
@@ -98,7 +88,7 @@ define([
             initialize: function(data){
                 BasePage.prototype.initialize.apply(this, arguments);
 
-                this.group_list = new appViews.GroupListView({
+                this.group_list = new app.views.GroupListView({
                     className: 'group-list',
                     id: 'event_list',
                     members: data.groups,
@@ -106,7 +96,7 @@ define([
                     realtime: ($.cookie('pausestream') ? false : true),
                     canStream: this.options.canStream,
                     pollUrl: appConfig.urlPrefix + '/api/' + appConfig.selectedTeam.slug + '/' + appConfig.selectedProject.slug + '/poll/',
-                    model: appModels.Group
+                    model: app.models.Group
                 });
 
                 this.control = $('a[data-action=pause]');
@@ -120,7 +110,7 @@ define([
                 }, this));
 
                 $('#chart').height('50px');
-                appCharts.createBasic('#chart', {
+                app.charts.createBasic('#chart', {
                     placement: 'left'
                 });
             },
@@ -195,7 +185,7 @@ define([
                 BasePage.prototype.initialize.apply(this, arguments);
 
                 $('#chart').height('150px');
-                appCharts.createBasic('#chart');
+                app.charts.createBasic('#chart');
             }
 
         }),
@@ -264,15 +254,15 @@ define([
             initialize: function(data){
                 BasePage.prototype.initialize.apply(this, arguments);
 
-                this.group_list = new appViews.GroupListView({
+                this.group_list = new app.views.GroupListView({
                     className: 'group-list',
                     id: 'event_list',
                     members: [data.group],
-                    model: appModels.Group
+                    model: app.models.Group
                 });
 
                 $('#chart').height('150px');
-                appCharts.createBasic('#chart');
+                app.charts.createBasic('#chart');
 
                 $('#public-status .action').click(function(){
                     var $this = $(this);
@@ -401,13 +391,13 @@ define([
             },
 
             makeDefaultView: function(id){
-                return new appViews.GroupListView({
+                return new app.views.GroupListView({
                     className: 'events',
                     id: id,
                     maxItems: 5,
                     stream: this.options.stream,
                     realtime: this.options.realtime,
-                    model: appModels.Group
+                    model: app.models.Group
                 });
             },
 
@@ -811,5 +801,5 @@ define([
             }
 
         })
-    };
-});
+    });
+}());
diff --git a/src/sentry/static/sentry/app/charts.js b/src/sentry/static/sentry/app/charts.js
index 04874f29ae..13df847153 100644
--- a/src/sentry/static/sentry/app/charts.js
+++ b/src/sentry/static/sentry/app/charts.js
@@ -1,15 +1,4 @@
-define([
-    'jquery',
-    'moment',
-
-    'app/utils',
-
-    'jquery.flot',
-    'jquery.flot.dashes',
-    'jquery.flot.resize',
-    'jquery.flot.time',
-    'jquery.flot.tooltip'
-], function($, moment, utils){
+(function(){
     'use strict';
 
     var average = function(a) {
@@ -67,7 +56,7 @@ define([
         return d.format(fmt);
     };
 
-    var charts = {
+    app.charts = {
         render: function(el, options) {
             var $el = $('#chart');
             var url = $el.attr('data-api-url');
@@ -125,12 +114,12 @@ define([
                 }
             }
 
-            point_width = utils.floatFormat(100.0 / points.length, 2) + '%';
+            point_width = app.utils.floatFormat(100.0 / points.length, 2) + '%';
 
             // TODO: we should only remove nodes that are no longer valid
             for (i=0; i<points.length; i++) {
                 point = points[i];
-                pct = utils.floatFormat(point.y / maxval * 99, 2) + '%';
+                pct = app.utils.floatFormat(point.y / maxval * 99, 2) + '%';
                 title = point.y + ' events';
                 if (point.label) {
                     title = title + '<br>(' + point.label + ')';
@@ -248,6 +237,4 @@ define([
             });
         }
     };
-
-    return charts;
-});
+}());
diff --git a/src/sentry/static/sentry/app/collections.js b/src/sentry/static/sentry/app/collections.js
index 2e1ef17ccb..1bbc461a9e 100644
--- a/src/sentry/static/sentry/app/collections.js
+++ b/src/sentry/static/sentry/app/collections.js
@@ -1,16 +1,11 @@
-define([
-    'backbone',
-    'jquery',
-    'moment',
-    'underscore'
-], function(Backbone, $, moment, _){
-    'use strict';
+(function(){
+  'use strict';
 
-    return {
-        ScoredList: Backbone.Collection.extend({
-            comparator: function(member){
-                return -member.get('score');
-            }
-        })
-    };
-});
+  app.collections = {
+    ScoredList: Backbone.Collection.extend({
+      comparator: function(member){
+        return -member.get('score');
+      }
+    })
+  };
+}());
diff --git a/src/sentry/static/sentry/app/config.js b/src/sentry/static/sentry/app/config.js
deleted file mode 100644
index eec4d58319..0000000000
--- a/src/sentry/static/sentry/app/config.js
+++ /dev/null
@@ -1,6 +0,0 @@
-define([
-], function(){
-  'use strict';
-
-  return window.SentryConfig || {};
-});
diff --git a/src/sentry/static/sentry/app/controllers/default.js b/src/sentry/static/sentry/app/controllers/default.js
index d91e2f3440..4449103f28 100644
--- a/src/sentry/static/sentry/app/controllers/default.js
+++ b/src/sentry/static/sentry/app/controllers/default.js
@@ -1,9 +1,8 @@
-define([
-  'app',
-], function(app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'DefaultCtrl'
-  });
-});
+  angular.module('sentry.controllers.default', ['classy'])
+    .classy.controller({
+      name: 'DefaultCtrl'
+    });
+}());
diff --git a/src/sentry/static/sentry/app/controllers/deleteTeam.js b/src/sentry/static/sentry/app/controllers/deleteTeam.js
index 937aaa70a6..97519e2e6e 100644
--- a/src/sentry/static/sentry/app/controllers/deleteTeam.js
+++ b/src/sentry/static/sentry/app/controllers/deleteTeam.js
@@ -1,30 +1,29 @@
-define([
-  'app'
-], function(app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'DeleteTeamCtrl',
+  angular.module('sentry.controllers.deleteTeam', ['classy'])
+    .classy.controller({
+      name: 'DeleteTeamCtrl',
 
-    inject: ['$scope', '$http', 'selectedTeam'],
+      inject: ['$scope', '$http', 'selectedTeam'],
 
-    init: function() {
-      var $scope = this.$scope;
+      init: function() {
+        var $scope = this.$scope;
 
-      $scope.newOwner = null;
+        $scope.newOwner = null;
 
-      this.$http.get('/api/0/teams/' + this.selectedTeam.id + '/projects/').success(function(data){
-        $scope.projectList = data;
-      });
-    },
+        this.$http.get('/api/0/teams/' + this.selectedTeam.id + '/projects/').success(function(data){
+          $scope.projectList = data;
+        });
+      },
 
-    saveForm: function() {
-      this.$http({
-        method: 'DELETE',
-        url: '/api/0/teams/' + this.selectedTeam.id + '/'
-      }).success(function(data){
-        window.location.href = '/';
-      });
-    }
-  });
-});
+      saveForm: function() {
+        this.$http({
+          method: 'DELETE',
+          url: '/api/0/teams/' + this.selectedTeam.id + '/'
+        }).success(function(data){
+          window.location.href = '/';
+        });
+      }
+    });
+}());
diff --git a/src/sentry/static/sentry/app/controllers/groupDetails.js b/src/sentry/static/sentry/app/controllers/groupDetails.js
index d67de69bd1..727490c524 100644
--- a/src/sentry/static/sentry/app/controllers/groupDetails.js
+++ b/src/sentry/static/sentry/app/controllers/groupDetails.js
@@ -1,17 +1,15 @@
-define([
-  'app'
-], function(app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'GroupDetailsCtrl',
+  angular.module('sentry.controllers.groupDetails', ['classy'])
+    .classy.controller({
+      name: 'GroupDetailsCtrl',
 
-    inject: ['$scope', '$http'],
-
-    init: function() {
-      // TODO(dcramer): remove the window hack
-      this.$http.post('/api/0/groups/' + window.SentryConfig.selectedGroup.id + '/markseen/');
-    }
-  });
-});
+      inject: ['$scope', '$http'],
 
+      init: function() {
+        // TODO(dcramer): remove the window hack
+        this.$http.post('/api/0/groups/' + window.SentryConfig.selectedGroup.id + '/markseen/');
+      }
+    });
+}());
diff --git a/src/sentry/static/sentry/app/controllers/loginSudo.js b/src/sentry/static/sentry/app/controllers/loginSudo.js
index d83584b0ad..b6c2298ec2 100644
--- a/src/sentry/static/sentry/app/controllers/loginSudo.js
+++ b/src/sentry/static/sentry/app/controllers/loginSudo.js
@@ -1,10 +1,9 @@
-define([
-  'app',
-], function(app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'LoginSudoCtrl'
-  });
-});
+  angular.module('sentry.controllers.loginSudo', ['classy'])
+    .classy.controller({
+      name: 'LoginSudoCtrl'
+    });
+}());
 
diff --git a/src/sentry/static/sentry/app/controllers/manageTeamOwnership.js b/src/sentry/static/sentry/app/controllers/manageTeamOwnership.js
index c617dd2405..93c3e4ebcb 100644
--- a/src/sentry/static/sentry/app/controllers/manageTeamOwnership.js
+++ b/src/sentry/static/sentry/app/controllers/manageTeamOwnership.js
@@ -1,27 +1,26 @@
-define([
-  'app'
-], function(app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'ManageTeamOwnershipCtrl',
+  angular.module('sentry.controllers.manageTeamOwnership', ['classy'])
+    .classy.controller({
+      name: 'ManageTeamOwnershipCtrl',
 
-    inject: ['$scope', '$http', 'selectedTeam'],
+      inject: ['$scope', '$http', 'selectedTeam'],
 
-    init: function() {
-      this.$scope.newOwner = null;
-    },
+      init: function() {
+        this.$scope.newOwner = null;
+      },
 
-    isUnchanged: function(value) {
-      return value === null;
-    },
+      isUnchanged: function(value) {
+        return value === null;
+      },
 
-    saveForm: function() {
-      this.$http.put('/api/0/teams/' + this.selectedTeam.id + '/', {
-        'owner': this.$scope.newOwner
-      }).success(function(data){
-        window.location.href = '/';
-      });
-    }
-  });
-});
+      saveForm: function() {
+        this.$http.put('/api/0/teams/' + this.selectedTeam.id + '/', {
+          'owner': this.$scope.newOwner
+        }).success(function(data){
+          window.location.href = '/';
+        });
+      }
+    });
+}());
diff --git a/src/sentry/static/sentry/app/controllers/manageTeamSettings.js b/src/sentry/static/sentry/app/controllers/manageTeamSettings.js
index 9c44912b57..3c58db294d 100644
--- a/src/sentry/static/sentry/app/controllers/manageTeamSettings.js
+++ b/src/sentry/static/sentry/app/controllers/manageTeamSettings.js
@@ -1,35 +1,33 @@
-define([
-  'angular',
-  'app'
-], function(angular, app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'ManageTeamSettingsCtrl',
+  angular.module('sentry.controllers.manageTeamSettings', ['classy'])
+    .classy.controller({
+      name: 'ManageTeamSettingsCtrl',
 
-    inject: ['$scope', '$http', 'selectedTeam'],
+      inject: ['$scope', '$http', 'selectedTeam'],
 
-    init: function() {
-      this.$scope.teamData = {
-        name: this.selectedTeam.name,
-        slug: this.selectedTeam.slug
-      };
-    },
+      init: function() {
+        this.$scope.teamData = {
+          name: this.selectedTeam.name,
+          slug: this.selectedTeam.slug
+        };
+      },
 
-    isUnchanged: function() {
-      for (var name in this.$scope.teamData) {
-        if (this.selectedTeam[name] != this.$scope.teamData[name]) {
-          return false;
+      isUnchanged: function() {
+        for (var name in this.$scope.teamData) {
+          if (this.selectedTeam[name] != this.$scope.teamData[name]) {
+            return false;
+          }
         }
-      }
-      return true;
-    },
+        return true;
+      },
 
-    saveForm: function() {
-      this.$http.put('/api/0/teams/' + this.selectedTeam.id + '/', this.$scope.teamData)
-        .success(function(data){
-          window.location.href = '/account/teams/' + data.slug + '/settings';
-        });
-    }
-  });
-});
+      saveForm: function() {
+        this.$http.put('/api/0/teams/' + this.selectedTeam.id + '/', this.$scope.teamData)
+          .success(function(data){
+            window.location.href = '/account/teams/' + data.slug + '/settings';
+          });
+      }
+    });
+}());
diff --git a/src/sentry/static/sentry/app/controllers/projectStream.js b/src/sentry/static/sentry/app/controllers/projectStream.js
index 5f420896a4..12f0b56d9c 100644
--- a/src/sentry/static/sentry/app/controllers/projectStream.js
+++ b/src/sentry/static/sentry/app/controllers/projectStream.js
@@ -1,46 +1,43 @@
 /*jshint -W024 */
 
-define([
-  'app',
-
-  'app/utils'
-], function(app, utils) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'ProjectStreamCtrl',
+  angular.module('sentry.controllers.projectStream', ['classy'])
+    .classy.controller({
+      name: 'ProjectStreamCtrl',
 
-    inject: ['Collection', 'selectedProject', '$http', '$scope', '$window', '$timeout'],
+      inject: ['Collection', 'selectedProject', '$http', '$scope', '$window', '$timeout'],
 
-    init: function() {
-      this.$scope.groupList = new this.Collection(this.$window.groupList);
+      init: function() {
+        this.$scope.groupList = new this.Collection(this.$window.groupList);
 
-      this.$timeout(this.pollForChanges, 1000);
+        this.$timeout(this.pollForChanges, 1000);
 
-      this.setChartDuration('1d');
-    },
+        this.setChartDuration('1d');
+      },
 
-    setChartDuration: function(duration) {
-      this.$scope.chartDuration = duration;
-      $.each(this.$scope.groupList, function(_, group){
-        group.activeChartData = group.stats['24h'];
-      });
-    },
+      setChartDuration: function(duration) {
+        this.$scope.chartDuration = duration;
+        $.each(this.$scope.groupList, function(_, group){
+          group.activeChartData = group.stats['24h'];
+        });
+      },
 
-    pollForChanges: function() {
-      var self = this;
+      pollForChanges: function() {
+        var self = this;
 
-      this.$http.get('/api/0/projects/' + this.selectedProject.id + '/groups/').success(function(data){
-        for (var i = 0; i < data.length; i++) {
-          self.$scope.groupList.unshift(data[i]);
-        }
-        utils.sortArray(self.$scope.groupList, function(item){
-          return [new Date(item.lastSeen).getTime()];
-        }).splice(50);
+        this.$http.get('/api/0/projects/' + this.selectedProject.id + '/groups/').success(function(data){
+          for (var i = 0; i < data.length; i++) {
+            self.$scope.groupList.unshift(data[i]);
+          }
+          utils.sortArray(self.$scope.groupList, function(item){
+            return [new Date(item.lastSeen).getTime()];
+          }).splice(50);
 
-      }).finally(function(){
-        self.$timeout(self.pollForChanges, 1000);
-      });
-    }
-  });
-});
+        }).finally(function(){
+          self.$timeout(self.pollForChanges, 1000);
+        });
+      }
+    });
+}());
diff --git a/src/sentry/static/sentry/app/controllers/teamDashboard.js b/src/sentry/static/sentry/app/controllers/teamDashboard.js
index bceb2e4589..51c0581389 100644
--- a/src/sentry/static/sentry/app/controllers/teamDashboard.js
+++ b/src/sentry/static/sentry/app/controllers/teamDashboard.js
@@ -1,14 +1,13 @@
 /*jshint -W024 */
 
-define([
-  'app',
-], function(app) {
+(function(){
   'use strict';
 
-  app.classy.controller({
-    name: 'TeamDashboardCtrl',
+  angular.module('sentry.controllers.teamDashboard', ['classy'])
+    .classy.controller({
+      name: 'TeamDashboardCtrl',
 
-    init: function() {
-    }
-  });
-});
+      init: function() {
+      }
+    });
+}());
diff --git a/src/sentry/static/sentry/app/core.js b/src/sentry/static/sentry/app/core.js
deleted file mode 100644
index a3c6a98e43..0000000000
--- a/src/sentry/static/sentry/app/core.js
+++ /dev/null
@@ -1,5 +0,0 @@
-app = window.app = {
-    config: {},
-    templates: {},
-    utils: {}
-};
diff --git a/src/sentry/static/sentry/app/directives/count.js b/src/sentry/static/sentry/app/directives/count.js
index 1e481167aa..9660f4ae20 100644
--- a/src/sentry/static/sentry/app/directives/count.js
+++ b/src/sentry/static/sentry/app/directives/count.js
@@ -1,4 +1,4 @@
-define(['app'], function(app){
+(function(){
   'use strict';
 
   var numberFormats = [
@@ -31,14 +31,15 @@ define(['app'], function(app){
       return '' + number;
   };
 
-  app.directive('count', function() {
-    return function(scope, element, attrs){
-      var value = scope.$eval(attrs.count);
-      if (value === undefined) {
-        element.text('');
-      } else {
-        element.text(formatNumber(value));
-      }
-    };
-  });
-});
+  angular.module('sentry.directives.count', [])
+    .directive('count', function() {
+      return function(scope, element, attrs){
+        var value = scope.$eval(attrs.count);
+        if (value === undefined) {
+          element.text('');
+        } else {
+          element.text(formatNumber(value));
+        }
+      };
+    });
+}());
diff --git a/src/sentry/static/sentry/app/directives/timeSince.js b/src/sentry/static/sentry/app/directives/timeSince.js
index 8c640d2db2..4d8391af0d 100644
--- a/src/sentry/static/sentry/app/directives/timeSince.js
+++ b/src/sentry/static/sentry/app/directives/timeSince.js
@@ -1,32 +1,33 @@
-define(['app', 'moment'], function(app, moment) {
+(function(){
   'use strict';
 
-  app.directive('timeSince', ['$timeout', function($timeout) {
-    return function timeSince(scope, element, attrs) {
-      var timeout_id;
+  angular.module('sentry.directives.timeSince', [])
+    .directive('timeSince', ['$timeout', function($timeout) {
+      return function timeSince(scope, element, attrs) {
+        var timeout_id;
 
-      function update(value){
-        if (!value || value === undefined) {
-          return '';
-        }
+        function update(value){
+          if (!value || value === undefined) {
+            return '';
+          }
 
-        element.text(moment.utc(value).fromNow());
-      }
+          element.text(moment.utc(value).fromNow());
+        }
 
-      function tick(){
-        update(scope.$eval(attrs.timeSince));
-        timeout_id = $timeout(tick, 1000);
-      }
+        function tick(){
+          update(scope.$eval(attrs.timeSince));
+          timeout_id = $timeout(tick, 1000);
+        }
 
-      scope.$watch(attrs.timeSince, update);
+        scope.$watch(attrs.timeSince, update);
 
-      element.bind('$destroy', function() {
-        if (timeout_id) {
-          $timeout.cancel(timeout_id);
-        }
-      });
+        element.bind('$destroy', function() {
+          if (timeout_id) {
+            $timeout.cancel(timeout_id);
+          }
+        });
 
-      tick();
-    };
-  }]);
-});
+        tick();
+      };
+    }]);
+}());
diff --git a/src/sentry/static/sentry/app/init.js b/src/sentry/static/sentry/app/init.js
index b62f8548a5..b92f853742 100644
--- a/src/sentry/static/sentry/app/init.js
+++ b/src/sentry/static/sentry/app/init.js
@@ -1,26 +1,4 @@
-define([
-  'bootstrap',
-  'moment',
-  'jquery',
-
-  'app',
-  'app/base',
-  'app/charts',
-  'app/config',
-  'app/collections',
-  'app/core',
-  'app/models',
-  'app/templates',
-  'app/views',
-  'app/utils',
-
-  'bootstrap-datepicker',
-  'jquery.clippy',
-  'jquery.cookie',
-  'selectize'
-], function (bootstrap, moment, $, app, appBase, appCharts,
-             appConfig, appCollections, appCore, appModels, appTemplates,
-             appViews, appUtils) {
+(function(){
   'use strict';
 
   $('.clippy').clippy({
@@ -63,8 +41,4 @@ define([
           }
       });
   }, 5000);
-
-  var Sentry = $.extend({}, appBase);
-  Sentry.utils = appUtils;
-  return Sentry;
-});
+}());
diff --git a/src/sentry/static/sentry/app/models.js b/src/sentry/static/sentry/app/models.js
index 2045352915..3ea27b1210 100644
--- a/src/sentry/static/sentry/app/models.js
+++ b/src/sentry/static/sentry/app/models.js
@@ -1,9 +1,7 @@
-define([
-  'backbone'
-], function(Backbone){
+(function(){
   'use strict';
 
-  return {
+  app.models = {
     Group: Backbone.Model.extend({
       defaults: {
         count: 0,
@@ -17,4 +15,4 @@ define([
       }
     })
   };
-});
+}());
diff --git a/src/sentry/static/sentry/app/modules/charts.js b/src/sentry/static/sentry/app/modules/charts.js
index 99afdc111b..206b5e6e0e 100644
--- a/src/sentry/static/sentry/app/modules/charts.js
+++ b/src/sentry/static/sentry/app/modules/charts.js
@@ -1,12 +1,4 @@
-define([
-  'angular',
-
-  'jquery.flot',
-  'jquery.flot.dashes',
-  'jquery.flot.resize',
-  'jquery.flot.time',
-  'jquery.flot.tooltip'
-], function(angular) {
+(function(){
   'use strict';
 
   var average = function(a) {
@@ -171,4 +163,4 @@ define([
         createBasicChart(element, attrs.simpleChart);
       };
     });
-});
+}());
diff --git a/src/sentry/static/sentry/app/modules/collection.js b/src/sentry/static/sentry/app/modules/collection.js
index 3d89eae2ae..9ad65726dc 100644
--- a/src/sentry/static/sentry/app/modules/collection.js
+++ b/src/sentry/static/sentry/app/modules/collection.js
@@ -1,4 +1,4 @@
-define(['angular'], function(angular) {
+(function(){
   'use strict';
 
   angular.module('sentry.collection', [])
@@ -89,4 +89,4 @@ define(['angular'], function(angular) {
 
       return Collection;
     });
-});
+}());
diff --git a/src/sentry/static/sentry/app/modules/forms.js b/src/sentry/static/sentry/app/modules/forms.js
index 99a4c1452c..dc22597255 100644
--- a/src/sentry/static/sentry/app/modules/forms.js
+++ b/src/sentry/static/sentry/app/modules/forms.js
@@ -1,6 +1,4 @@
-define([
-  'angular'
-], function(angular) {
+(function(){
   'use strict';
 
   var TEMPLATES = {
@@ -86,4 +84,4 @@ define([
         }
       };
     });
-});
+}());
diff --git a/src/sentry/static/sentry/app/templates.js b/src/sentry/static/sentry/app/templates.js
index 87214c798c..6205f08956 100644
--- a/src/sentry/static/sentry/app/templates.js
+++ b/src/sentry/static/sentry/app/templates.js
@@ -1,9 +1,46 @@
-define([
-    'text!app/templates/group.html'
-], function(groupTemplate){
-    'use strict';
+/*jshint multistr:true */
 
-    return {
-        group: groupTemplate
-    };
-});
+(function(){
+  'use strict';
+
+  var groupTemplate = '<div class="event-details event-cell"> \
+  <div class="checkbox"> \
+      <input type="checkbox"> \
+  </div> \
+  <h3><a href="<%= permalink %>"><%= title %></a></h3> \
+  <div class="event-meta"> \
+      <% if (timeSpent) { %><time><%= Math.round(timeSpent) %>ms</time> &middot;<% } %> \
+      <span class="message"><%= message %></span> \
+      &middot; <time><%= firstSeen %></time> \
+  </div> \
+</div> \
+<div class="event-assignee event-cell"> \
+  <div class="user-selector"> \
+    <div class="btn-group"> \
+      <a href="#" class="btn btn-sm btn-default dropdown-toggle"> \
+        <img src="http://github.com/benvinegar.png" class="avatar"> \
+        <span aria-hidden="true" class="icon-arrow-down"></span> \
+      </a> \
+      <ul class="dropdown-menu"> \
+        <li><a href="#"><img src="http://github.com/dcramer.png" class="avatar"> David Cramer</a></li> \
+        <li><a href="#"><img src="http://github.com/ckj.png" class="avatar"> Chris Jennings</a></li> \
+        <li><a href="#"><img src="http://github.com/mattrobenolt.png" class="avatar"> Matt Robenolt</a></li> \
+        <li><a href="#"><img src="http://github.com/byk.png" class="avatar"> Red Lobster</a></li> \
+      </ul> \
+    </div> \
+  </div> \
+</div> \
+<div class="hidden-sm hidden-xs event-graph align-right event-cell"> \
+    <span class="sparkline"></span> \
+</div> \
+<div class="hidden-xs event-occurrences align-center event-cell"> \
+  <span><%= utils.formatNumber(count) %></span> \
+</div> \
+<div class="hidden-xs event-users align-right event-cell"> \
+  <span>209</span> \
+</div>';
+
+  app.templates = {
+    group: groupTemplate
+  };
+}());
diff --git a/src/sentry/static/sentry/app/utils.js b/src/sentry/static/sentry/app/utils.js
index 4fe6753229..ff604666bd 100644
--- a/src/sentry/static/sentry/app/utils.js
+++ b/src/sentry/static/sentry/app/utils.js
@@ -1,8 +1,4 @@
-define([
-    'jquery',
-
-    'app/config'
-], function($, appConfig){
+(function(){
     'use strict';
 
     var number_formats = [
@@ -11,7 +7,7 @@ define([
         [1000, 'k']
     ];
 
-    return {
+    app.utils = {
         getQueryParams: function() {
 
             var vars = {},
@@ -174,4 +170,4 @@ define([
             }));
         }
     };
-});
+}());
diff --git a/src/sentry/static/sentry/app/views.js b/src/sentry/static/sentry/app/views.js
index a43ca67285..236a08d7d8 100644
--- a/src/sentry/static/sentry/app/views.js
+++ b/src/sentry/static/sentry/app/views.js
@@ -1,23 +1,13 @@
-define([
-    'backbone',
-    'moment',
-    'jquery',
-    'underscore',
-
-    'app/charts',
-    'app/collections',
-    'app/config',
-    'app/models',
-    'app/templates',
-    'app/utils'
-], function(Backbone, moment, $, _, appCharts, appCollections, appConfig, appModels, appTemplates, appUtils){
+(function(){
     'use strict';
 
-    var views = {};
-    views.GroupView = Backbone.View.extend({
+    var appConfig = window.SentryConfig;
+
+    app.views = {};
+    app.views.GroupView = Backbone.View.extend({
         tagName: 'li',
         className: 'group',
-        template: _.template(appTemplates.group),
+        template: _.template(app.templates.group),
 
         initialize: function(){
             Backbone.View.prototype.initialize.apply(this, arguments);
@@ -42,7 +32,7 @@ define([
             data.projectUrl = appConfig.urlPrefix + '/' + appConfig.selectedTeam.slug +
                 '/' + data.project.slug + '/';
             data.loggerUrl = data.projectUrl + '?logger=' + data.logger;
-            data.utils = appUtils;
+            data.utils = app.utils;
 
             this.$el.html(this.template(data));
             this.$el.attr('data-id', this.model.id);
@@ -97,7 +87,7 @@ define([
 
             this.$el.addClass('with-sparkline');
 
-            appCharts.createSparkline(this.$el.find('.sparkline'), data);
+            app.charts.createSparkline(this.$el.find('.sparkline'), data);
         },
 
         resolve: function(){
@@ -168,7 +158,7 @@ define([
         },
 
         updateCount: function(){
-            var new_count = appUtils.formatNumber(this.model.get('count'));
+            var new_count = app.utils.formatNumber(this.model.get('count'));
             var counter = this.$el.find('.count');
             var digit = counter.find('span');
 
@@ -210,7 +200,7 @@ define([
             var value = annotation.count;
             if (value === null)
                 return;
-            var new_count = appUtils.formatNumber(value);
+            var new_count = app.utils.formatNumber(value);
             var counter = this.$el.find('.annotation[data-tag="' + annotation.label + '"]');
             var digit = counter.find('span');
 
@@ -257,11 +247,11 @@ define([
 
     });
 
-    views.OrderedElementsView = Backbone.View.extend({
+    app.views.OrderedElementsView = Backbone.View.extend({
 
         emptyMessage: '<div class="empty-message"><h2>No events to show.</h2><p>We\'ll notify you if that changes. In the meantime why not take a moment to become more familiar with Sentry.</p><p class="links"><a href="docs/">Installation instructions</a> <a href="settings/">Project settings</a></p></div>',
         loadingMessage: '<p>Loading...</p>',
-        model: appModels.Group,
+        model: app.models.Group,
 
         defaults: {
             maxItems: 50,
@@ -288,7 +278,7 @@ define([
 
             _.bindAll(this, 'renderMemberInContainer', 'unrenderMember', 'reSortMembers');
 
-            this.collection = new appCollections.ScoredList([], {
+            this.collection = new app.collections.ScoredList([], {
                 model: data.model
             });
             this.collection.on('add', this.renderMemberInContainer, this);
@@ -427,8 +417,7 @@ define([
 
     });
 
-
-    views.GroupListView = views.OrderedElementsView.extend({
+    app.views.GroupListView = app.views.OrderedElementsView.extend({
 
         defaults: {
             realtime: false,
@@ -442,14 +431,14 @@ define([
             if (_.isUndefined(data))
                 data = {};
 
-            data.model = appModels.Group;
-            data.view = views.GroupView;
+            data.model = app.models.Group;
+            data.view = app.views.GroupView;
 
-            views.OrderedElementsView.prototype.initialize.call(this, data);
+            app.views.OrderedElementsView.prototype.initialize.call(this, data);
 
             this.options = $.extend({}, this.defaults, this.options, data);
 
-            this.queue = new appCollections.ScoredList([], {
+            this.queue = new app.collections.ScoredList([], {
                 model: data.model
             });
 
@@ -498,7 +487,7 @@ define([
             if (!this.options.realtime || !this.options.pollUrl)
                 return window.setTimeout(this.poll, this.options.pollTime);
 
-            data = appUtils.getQueryParams();
+            data = app.utils.getQueryParams();
             data.cursor = this.cursor || undefined;
 
             $.ajax({
@@ -512,6 +501,4 @@ define([
         }
 
     });
-
-    return views;
-});
+}());
diff --git a/src/sentry/static/sentry/config.js b/src/sentry/static/sentry/config.js
deleted file mode 100644
index 744e8ef275..0000000000
--- a/src/sentry/static/sentry/config.js
+++ /dev/null
@@ -1,88 +0,0 @@
-var require = {
-  paths: {
-    'angular': 'vendor/angular/angular.min',
-    'backbone': 'vendor/backbone/backbone',
-    'bootstrap': 'vendor/bootstrap/dist/js/bootstrap.min',
-    'bootstrap-datepicker': 'vendor/bootstrap-datepicker/js/bootstrap-datepicker',
-    'd3': 'vendor/d3/d3.min',
-    'd3-tip': 'vendor/d3-tip/index',
-    'jquery': 'vendor/jquery/jquery.min',
-    'jquery.clippy': 'scripts/lib/jquery.clippy.min',
-    'jquery.cookie': 'scripts/lib/jquery.cookie',
-    'jquery.flot': 'vendor/jquery-flot/jquery.flot',
-    'jquery.flot.dashes': 'scripts/lib/jquery.flot.dashes',
-    'jquery.flot.resize': 'vendor/jquery-flot/jquery.flot.resize',
-    'jquery.flot.time': 'vendor/jquery-flot/jquery.flot.time',
-    'jquery.flot.tooltip': 'scripts/lib/jquery.flot.tooltip',
-    'json2': 'vendor/json2/json2',
-    'moment': 'vendor/moment/min/moment.min',
-    'ngBootstrap': 'vendor/angular-bootstrap/ui-bootstrap-tpls.min',
-    'ngClassy': 'vendor/angular-classy/angular-classy.min',
-    'ngHttpAuth': 'vendor/angular-http-auth/src/http-auth-interceptor',
-    'ngLoadingBar': 'vendor/angular-loading-bar/build/loading-bar.min',
-    'ngRaven': 'vendor/angular-raven/angular-raven',
-    'ngRoute': 'vendor/angular-route/angular-route',
-    'ngRouter': 'vendor/angular-ui-router/release/angular-ui-router',
-    'ngSanitize': 'vendor/angular-sanitize/angular-sanitize',
-    'selectize': 'vendor/selectize/dist/js/standalone/selectize.min',
-    'simple-slider': 'vendor/simple-slider/js/simple-slider.min',
-    'underscore': 'vendor/underscore/underscore',
-    'text': 'vendor/requirejs-plugins/lib/text',
-  },
-  shim: {
-    'backbone': {
-      deps: ['json2', 'underscore']
-    },
-    'bootstrap': {
-      deps: ['jquery']
-    },
-    'bootstrap-datepicker': {
-      deps: ['bootstrap']
-    },
-    'jquery': {
-      exports: ['jquery', '$']
-    },
-    'jquery.clippy': {
-      deps: ['jquery']
-    },
-    'jquery.cookie': {
-      deps: ['jquery']
-    },
-    'jquery.migrate': {
-      deps: ['jquery']
-    },
-    'jquery.flot': {
-      deps: ['jquery']
-    },
-    'jquery.flot.dashes': {
-      deps: ['jquery.flot']
-    },
-    'jquery.flot.resize': {
-      deps: ['jquery.flot']
-    },
-    'jquery.flot.time': {
-      deps: ['jquery.flot']
-    },
-    'jquery.flot.tooltip': {
-      deps: ['jquery.flot']
-    },
-    'angular': {
-      exports: 'angular',
-      deps: ['jquery']
-    },
-    'ngBootstrap': ['angular'],
-    'ngClassy': ['angular'],
-    'ngHttpAuth': ['angular'],
-    'ngLoadingBar': ['angular'],
-    'ngRaven': ['angular'],
-    'ngRoute': ['angular'],
-    'ngSanitize': ['angular'],
-    'ngRouter': ['angular'],
-    'simple-slider': {
-      deps: ['jquery']
-    },
-    'underscore': {
-      exports: '_'
-    }
-  }
-};
diff --git a/src/sentry/static/sentry/legacy-app.min.js b/src/sentry/static/sentry/legacy-app.min.js
new file mode 100644
index 0000000000..d82c1d32f7
--- /dev/null
+++ b/src/sentry/static/sentry/legacy-app.min.js
@@ -0,0 +1,4 @@
+if(typeof JSON!=="object"){JSON={}}(function(){"use strict";function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx,escapable,gap,indent,meta,rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return obj;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return}}return obj};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,predicate,context){var result;any(obj,function(value,index,list){if(predicate.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(predicate,context);each(obj,function(value,index,list){if(predicate.call(context,value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)};_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(predicate,context);each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(predicate,context);each(obj,function(value,index,list){if(result||(result=predicate.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}var result=-Infinity,lastComputed=-Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed>lastComputed){result=value;lastComputed=computed}});return result};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}var result=Infinity,lastComputed=Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed<lastComputed){result=value;lastComputed=computed}});return result};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){if(value==null)return _.identity;if(_.isFunction(value))return value;return _.property(value)};_.sortBy=function(obj,iterator,context){iterator=lookupIterator(iterator);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};iterator=lookupIterator(iterator);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]});_.indexBy=group(function(result,key,value){result[key]=value});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1});_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.partition=function(array,predicate){var pass=[],fail=[];each(array,function(elem){(predicate(elem)?pass:fail).push(elem)});return[pass,fail]};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,length+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++]}while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args)}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait)}if(callNow){result=func.apply(context,args);context=args=null}return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b){return false}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){return function(obj){if(obj===attrs)return true;for(var key in attrs){if(attrs[key]!==obj[key])return false}return true}};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}});if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this);(function(root,factory){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)})}else if(typeof exports!=="undefined"){var _=require("underscore");factory(root,exports,_)}else{root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}})(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;Backbone.VERSION="1.1.2";Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events=void 0;return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==="object")callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id]}return this}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId("l"));listeningTo[id]=obj;if(!callback&&typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,"defaults"));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=options;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false}else{if(!this._validate(attrs,options))return false}if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)
+}if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return false}wrapError(this,options);var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return false}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model,options)}return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i]||{};if(attrs instanceof Model){id=model=attrs}else{id=attrs[targetModel.prototype.idAttribute||"id"]}if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}models[i]=existing}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);this._addReference(model,options)}model=existing||model;if(order&&(model.isNew()||!modelMap[model.id]))order.push(model);modelMap[model.id]=true}if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this.remove(toRemove,options)}if(toAdd.length||order&&order.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i])}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i])}}}if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger("add",model,this,options)}if(sort||order&&order.length)this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i],options)}options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(obj==null)return void 0;return this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?"find":"filter"](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return false},_addReference:function(model,options){this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;if(!model.collection)model.collection=this;model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}if(params.type==="PATCH"&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var noXhrPatch=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},execute:function(callback,args){if(callback)callback.apply(this,args)},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)");return new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.slice(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else if(this._hasPushState&&this.atRoot()&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment)}}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}})},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||""));fragment=fragment.replace(pathStripper,"");if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===""&&url!=="/")url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)return this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger("error",model,resp,options)}};return Backbone});(function(){"use strict";$(".clippy").clippy({clippy_path:"../clippy.swf",keep_text:true});$('input[data-toggle="datepicker"]').datepicker();$(".tip").tooltip({html:true,container:"body"});$(".trigger-popover").popover({html:true,container:"body"});$(".nav-tabs .active a").tab("show");$(".project-selector").on("change",function(e){var $el=$(e.target).get(0);var $opt=$($el.options[$el.selectedIndex]);window.location.href=$opt.attr("data-url");return false});setInterval(function(){$(".pretty-date").each(function(_,el){var $el=$(el);var dt=$el.data("datetime");if(dt){var date=moment(dt);if(date){$el.text(date.fromNow());$el.attr("title",date.format("llll"))}}})},5e3)})();(function(){"use strict";var appConfig=window.SentryConfig;var BasePage=Backbone.View.extend({defaults:{canStream:false,realtime:false},initialize:function(data){Backbone.View.prototype.initialize.apply(this,arguments);if(_.isUndefined(data))data={};this.options=$.extend({},this.defaults,this.options,data);this.views={};this.initializeAjaxTabs()},initializeAjaxTabs:function(){$("a[data-toggle=ajtab]").click(_.bind(function(e){var $tab=$(e.target),uri=$tab.attr("data-uri"),view_id=$tab.attr("href").substr(1),view=this.getView(view_id,uri),$cont,$parent;e.preventDefault();if(!uri)return view.reset();$cont=$("#"+view_id);$parent=$cont.parent();$parent.css("opacity",.6);$.ajax({url:uri,dataType:"json",success:function(data){view.reset(data);$parent.css("opacity",1);$tab.tab("show")},error:function(){$cont.html("<p>There was an error fetching data from the server.</p>")}})},this));$("li.active a[data-toggle=ajtab]").click()},makeDefaultView:function(id){return new app.views.GroupListView({className:"events small",id:id,maxItems:5,stream:this.options.stream,realtime:this.options.realtime,model:app.models.Group})},getView:function(id,uri){if(!this.views[id])this.views[id]=this.makeDefaultView(id);var view=this.views[id];view.options.pollUrl=uri;return view}});$.extend(app,{BasePage:BasePage,StreamPage:BasePage.extend({initialize:function(data){BasePage.prototype.initialize.apply(this,arguments);this.group_list=new app.views.GroupListView({className:"group-list",id:"event_list",members:data.groups,maxItems:50,realtime:$.cookie("pausestream")?false:true,canStream:this.options.canStream,pollUrl:appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/"+appConfig.selectedProject.slug+"/poll/",model:app.models.Group});this.control=$("a[data-action=pause]");this.updateStreamOptions();this.initFilters();this.control.click(_.bind(function(e){e.preventDefault();this.options.realtime=this.group_list.options.realtime=this.control.hasClass("realtime-paused");this.updateStreamOptions()},this));$("#chart").height("50px");app.charts.createBasic("#chart",{placement:"left"})},initFilters:function(){$(".filter").each(_.bind(function(_,el){var $filter=$(el);var $input=$filter.find("input[type=text]");if($input.length>0){$input.select2({initSelection:function(el,callback){var $el=$(el);callback({id:$el.val(),text:$el.val()})},allowClear:true,minimumInputLength:3,ajax:{url:appUtils.getSearchTagsUrl(),dataType:"json",data:function(term,page){return{query:term,quietMillis:300,name:$input.attr("name"),limit:10}},results:function(data,page){var results=[];$(data.results).each(function(_,val){results.push({id:appUtils.escape(val),text:appUtils.escape(val)})});return{results:results}}}})}else{$input=$filter.find("select").select2({allowClear:true})}if($input.length>0){$input.on("change",function(e){var query=appUtils.getQueryParams();query[e.target.name]=e.val;window.location.href="?"+$.param(query)})}},this))},updateStreamOptions:function(){if(this.options.realtime){$.removeCookie("pausestream");this.control.removeClass("realtime-paused");this.control.attr("title",this.control.attr("data-pause-label"))}else{$.cookie("pausestream","1",{expires:7});this.control.addClass("realtime-paused");this.control.attr("title",this.control.attr("data-play-label"))}}}),DashboardPage:BasePage.extend({initialize:function(data){BasePage.prototype.initialize.apply(this,arguments);$("#chart").height("150px");app.charts.createBasic("#chart")}}),SelectTeamPage:BasePage.extend({initialize:function(){BasePage.prototype.initialize.apply(this,arguments);this.refreshSparklines();$(window).on("resize",this.refreshSparklines)},refreshSparklines:function(){$(".chart").each(function(n,el){var $el=$(el);$.ajax({url:$el.attr("data-api-url"),type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-3600*24,resolution:"1h"},success:_.bind(function(data){for(var i=0;i<data.length;i++){data[i][0]=data[i][0]*1e3}$.plot($el,[{data:data,color:"#ebeff3",shadowSize:0,lines:{lineWidth:2,show:true,fill:true,color:"#f6f8fa"}}],{yaxis:{min:0},grid:{show:false},hoverable:false,legend:{noColumns:5},lines:{show:false}})},this)})})}}),GroupDetailsPage:BasePage.extend({initialize:function(data){BasePage.prototype.initialize.apply(this,arguments);this.group_list=new app.views.GroupListView({className:"group-list",id:"event_list",members:[data.group],model:app.models.Group});$("#chart").height("150px");app.charts.createBasic("#chart");$("#public-status .action").click(function(){var $this=$(this);$.ajax({url:$this.attr("data-api-url"),type:"post",success:function(group){var selector=group.isPublic?"true":"false";var nselector=group.isPublic?"false":"true";$('#public-status span[data-public="'+selector+'"]').show();$('#public-status span[data-public="'+nselector+'"]').hide()},error:function(){window.alert("There was an error changing the public status")}})});$(".add-note-form textarea").focus(function(){$(this).addClass("expanded")});$(".add-note-form textarea").keypress(function(e){if(e.which==13&&!e.shiftKey){$(".add-note-form").submit();return false}});var $event_nav=$("#event_nav");if($event_nav.length>0){var $window=$(window);var $nav_links=$event_nav.find("a[href*=#]");var $nav_targets=[];var scroll_offset=$event_nav.offset().top;var event_nav_height;var last_target;$window.resize(function(){event_nav_height=$event_nav.find(".nav").outerHeight();$event_nav.height(event_nav_height+"px")}).resize();$nav_links.click(function(e){var $el=$(this);var target=$(this.hash);$el.parent().addClass("active").siblings().removeClass("active");$("html,body").animate({scrollTop:target.position().top+event_nav_height},"fast");if(history.pushState){history.pushState({},"",this.hash)}e.preventDefault()}).each(function(){if(this.hash.length>1&&$(this.hash).length){$nav_targets.push(this.hash)}});var resizeTimer;$window.scroll(function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){if($window.scrollTop()>scroll_offset){if(!$event_nav.hasClass("fixed")){$event_nav.addClass("fixed")}}else if($event_nav.hasClass("fixed")){$event_nav.removeClass("fixed")}if($nav_targets.length){var from_top=$window.scrollTop()+event_nav_height+20;var cur=$.map($nav_targets,function(hash){if($(hash).offset().top<from_top){return hash}});var target=cur?cur[cur.length-1]:null;if(!target){target=$nav_targets[0]}if(last_target!==target){last_target=target;$nav_links.parent().removeClass("active").end().filter("[href="+target+"]").parent().addClass("active")}}},1)}).scroll()}}}),WallPage:BasePage.extend({initialize:function(){BasePage.prototype.initialize.apply(this,{realtime:true,pollTime:3e3});this.sparkline=$(".chart");this.sparkline.height(this.sparkline.parent().height());this.stats=$("#stats");_.bindAll(this,"refreshStats","refreshSparkline");this.refreshSparkline();this.refreshStats()},makeDefaultView:function(id){return new app.views.GroupListView({className:"events",id:id,maxItems:5,stream:this.options.stream,realtime:this.options.realtime,model:app.models.Group})},refreshSparkline:function(){$.ajax({url:this.sparkline.attr("data-api-url"),type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-3600*24,resolution:"1h"},success:_.bind(function(data){for(var i=0;i<data.length;i++){data[i][0]=data[i][0]*1e3}this.sparkline.empty();$.plot(this.sparkline,[{data:data,color:"#52566c",shadowSize:0,lines:{lineWidth:2,show:true,fill:true,fillColor:"#232428"}}],{yaxis:{min:0},grid:{show:false},hoverable:false,legend:{noColumns:5},lines:{show:false}});window.setTimeout(this.refreshSparkline,1e4)},this)})},refreshStats:function(){$.ajax({url:this.stats.attr("data-uri"),dataType:"json",success:_.bind(function(data){this.stats.find("[data-stat]").each(function(){var $this=$(this);var new_count=data[$this.attr("data-stat")];var counter=$this.find("big");var digit=counter.find("span");if(digit.is(":animated"))return false;if(counter.data("count")==new_count){return false}counter.data("count",new_count);var replacement=$("<span></span>",{css:{top:"-2.1em",opacity:0},text:new_count});digit.before(replacement).animate({top:"2.5em",opacity:0},"fast",function(){digit.remove()});replacement.delay(100).animate({top:0,opacity:1},"fast")});window.setTimeout(this.refreshStats,1e3)},this)})}}),AccessGroupMembersPage:BasePage.extend({initialize:function(){BasePage.prototype.initialize.apply(this,arguments);appUtils.makeSearchableUsersInput("form input[name=user]")}}),AccessGroupProjectsPage:BasePage.extend({initialize:function(){BasePage.prototype.initialize.apply(this,arguments);appUtils.makeSearchableProjectsInput("form input[name=project]")}}),ProjectDetailsPage:BasePage.extend({initialize:function(){BasePage.prototype.initialize.apply(this,arguments);appUtils.makeSearchableUsersInput("form input[name=owner]");$("input[type=range]").each(_.bind(function loop(n,el){var $el=$(el),min=parseInt($el.attr("min"),10),max=parseInt($el.attr("max"),10),step=parseInt($el.attr("step"),10),values=[],$value=$('<span class="value"></span>');var i=min;while(i<=max){values.push(i);if(i<12){i+=1}else if(i<24){i+=3}else if(i<36){i+=6}else if(i<48){i+=12}else{i+=24}}$el.on("slider:ready",_.bind(function sliderready(event,data){$value.appendTo(data.el);$value.html(this.formatHours(data.value))},this)).on("slider:changed",_.bind(function sliderchanged(event,data){$value.html(this.formatHours(data.value))},this)).simpleSlider({range:[min,max],step:step,allowedValues:values,snap:true})},this))},formatHours:function formatHours(val){val=parseInt(val,10);if(val===0){return"Disabled"}else if(val>23&&val%24===0){val=val/24;return val+" day"+(val!=1?"s":"")}return val+" hour"+(val!=1?"s":"")}}),ProjectNotificationsPage:BasePage.extend({initialize:function(){BasePage.prototype.initialize.apply(this,arguments);$("input[type=range]").each(_.bind(function loop(n,el){var $el=$(el),min=parseInt($el.attr("min"),10),max=parseInt($el.attr("max"),10),step=parseInt($el.attr("step"),10),$value=$('<span class="value"></span>');$el.on("slider:ready",_.bind(function sliderready(event,data){$value.appendTo(data.el);$value.html(this.formatThreshold(data.value))},this)).on("slider:changed",_.bind(function sliderchanged(event,data){$value.html(this.formatThreshold(data.value))},this)).simpleSlider({range:[min,max],step:step,snap:true})},this));$("#tag_list input").each(function(_,el){$(el).addClass("span6");appUtils.makeSearchableTagsInput(el)})},formatThreshold:function formatThreshold(value){if(!value){return"Disabled"}return value+"%"}}),NewProjectPage:BasePage.extend({initialize:function(data){this.el=$(data.el);BasePage.prototype.initialize.apply(this,arguments);if(this.options.canSelectTeam&&this.options.canCreateTeam){$("#new_team").hide();$('a[rel="create-new-team"]').click(function(){$("#new_team").show();$("#select_team").hide()});$('a[rel="select-team"]').click(function(){$("#new_team").hide();$("#select_team").show()})}}}),NewProjectRulePage:BasePage.extend({initialize:function(data){BasePage.prototype.initialize.apply(this,arguments);_.bindAll(this,"addAction","addCondition","parseFormData");this.actions_by_id={};this.conditions_by_id={};this.el=$(data.el);this.action_sel=this.el.find('select[id="action-select"]');this.action_table=this.el.find("table.action-list");this.action_table_body=this.action_table.find("tbody");this.condition_sel=this.el.find('select[id="condition-select"]');this.condition_table=this.el.find("table.condition-list");this.condition_table_body=this.condition_table.find("tbody");this.action_sel.empty();this.action_sel.append($("<option></option>"));$.each(data.actions,_.bind(function(_,action){var opt=$("<option></option>");opt.attr({value:action.id});opt.text(action.label);opt.appendTo(this.action_sel);this.actions_by_id[action.id]=action},this));this.condition_sel.empty();this.condition_sel.append($("<option></option>"));$.each(data.conditions,_.bind(function(_,condition){var opt=$("<option></option>");opt.attr({value:condition.id});
+opt.text(condition.label);opt.appendTo(this.condition_sel);this.conditions_by_id[condition.id]=condition},this));this.action_sel.selectize();this.condition_sel.selectize();this.action_sel.change(_.bind(function(){this.addAction(this.action_sel.val())},this));this.condition_sel.change(_.bind(function(){this.addCondition(this.condition_sel.val())},this));this.parseFormData(data.form_data,data.form_errors)},parseFormData:function(form_data,form_errors){var data={action:{},action_match:form_data.action_match||"all",condition:{},label:form_data.label||""};form_errors=form_errors||{};$.each(form_data,function(key,value){var matches=key.match(/^(condition|action)\[(\d+)\]\[(.+)\]$/);var type,num;if(!matches){return}type=matches[1];num=matches[2];if(data[type][num]===undefined){data[type][num]={}}data[type][num][matches[3]]=value});this.el.find("input[name=label]").val(data.label);this.el.find('select[name="action_match"]').val(data.action_match);$.each(_.sortBy(data.condition),_.bind(function(num,item){this.addCondition(item.id,item,form_errors["condition["+num+"]"]||false)},this));$.each(_.sortBy(data.action),_.bind(function(num,item){this.addAction(item.id,item,form_errors["action["+num+"]"]||false)},this))},addCondition:function(id,options,has_errors){var node=this.conditions_by_id[id],row=$("<tr></tr>"),remove_btn=$('<button class="btn btn-default btn-sm"><span class="icon-trash"></span></button>'),num=this.condition_table_body.find("tr").length,html=$("<div>"+node.html+"</div>"),prefix="condition["+num+"]",id_field=$('<input type="hidden" name="'+prefix+'[id]" value="'+node.id+'">');has_errors=has_errors||false;options=options||{};if(has_errors){row.addClass("error")}html.find("select").selectize();html.find("input, select, textarea").each(function(_,el){var $el=$(el),name=$el.attr("name");$el.attr("name",prefix+"["+name+"]");$el.val(options[name]||"")});row.append($("<td></td>").append(html).append(id_field));row.append($('<td class="align-right"></td>').append(remove_btn));row.appendTo(this.condition_table_body);remove_btn.click(function(){row.remove();return false});this.condition_sel.data("selectize").clear();this.condition_table.show()},addAction:function(id,options,has_errors){var node=this.actions_by_id[id],row=$("<tr></tr>"),remove_btn=$('<button class="btn btn-default btn-sm"><span class="icon-trash"></span></button>'),num=this.action_table_body.find("tr").length,html=$("<div>"+node.html+"</div>"),prefix="action["+num+"]",id_field=$('<input type="hidden" name="'+prefix+'[id]" value="'+node.id+'">');has_errors=has_errors||false;options=options||{};if(has_errors){row.addClass("error")}html.find("select").selectize();html.find("input, select, textarea").each(function(_,el){var $el=$(el),name=$el.attr("name");$el.attr("name",prefix+"["+name+"]");$el.val(options[name]||"")});row.append($("<td></td>").append(html).append(id_field));row.append($('<td class="align-right"></td>').append(remove_btn));row.appendTo(this.action_table_body);remove_btn.click(function(){row.remove();return false});this.action_sel.data("selectize").clear();this.action_table.show()}})})})();(function(){"use strict";var average=function(a){var r={mean:0,variance:0,deviation:0},t=a.length;for(var m,s=0,l=t;l--;s+=a[l]);for(m=r.mean=s/t,l=t,s=0;l--;s+=Math.pow(a[l]-m,2));r.deviation=Math.sqrt(r.variance=s/t);return r};var percentile=function(a,nth){a=a.sort();a.slice(0,a.length-Math.floor(nth/a.length));return average(a)};var timeUnitSize={second:1e3,minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,quarter:3*30*24*60*60*1e3,year:365.2425*24*60*60*1e3};var tickFormatter=function(value,axis){var d=moment(value);var t=axis.tickSize[0]*timeUnitSize[axis.tickSize[1]];var span=axis.max-axis.min;var fmt;if(t<timeUnitSize.minute){fmt="LT"}else if(t<timeUnitSize.day){fmt="LT";if(span<2*timeUnitSize.day){fmt="LT"}else{fmt="MMM D LT"}}else if(t<timeUnitSize.month){fmt="MMM D"}else if(t<timeUnitSize.year){if(span<timeUnitSize.year){fmt="MMM"}else{fmt="MMM YY"}}else{fmt="YY"}return d.format(fmt)};app.charts={render:function(el,options){var $el=$("#chart");var url=$el.attr("data-api-url");var title=$(el).attr("data-title");var $spark=$el.find(".sparkline");$spark.height($el.height());$.ajax({url:$el.attr("data-api-url"),type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-3600*24,resolution:"1h"},success:function(resp){var data=[],maxval=10;$spark.empty();$.each(resp,function(_,val){var date=new Date(val[0]*1e3);data.push({y:val[1],label:moment(date).fromNow()});if(val[1]>maxval){maxval=val[1]}});charts.createSparkline($spark,data,options)}})},createSparkline:function(el,points,options){var $el=$(el),existing=$el.children(),maxval=10,title,point,pct,child,point_width;if(options===undefined){options={}}for(var i=0;i<points.length;i++){point=points[i];if(typeof point==="number"){point=points[i]={y:point}}if(point.y>maxval){maxval=point.y}}point_width=app.utils.floatFormat(100/points.length,2)+"%";for(i=0;i<points.length;i++){point=points[i];pct=app.utils.floatFormat(point.y/maxval*99,2)+"%";title=point.y+" events";if(point.label){title=title+"<br>("+point.label+")"}if(existing.get(i)===undefined){$('<a style="width:'+point_width+';" rel="tooltip" title="'+title+'"><span style="height:'+pct+'">'+point.y+"</span></a>").tooltip({placement:options.placement||"bottom",html:true,container:"body"}).appendTo($el)}else{$(existing[i]).find("span").css("height",pct).text(point.y).attr("title",point.label||point.y)}}},createBasic:function(el){var $sparkline=$(el);if($sparkline.length<1){return}$.ajax({url:$sparkline.attr("data-api-url"),type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-3600*24*7,resolution:"1h"},success:function(data){var inputs=[],avg,i,data_avg=[],p_95th;for(i=0;i<data.length;i++){inputs.push(data[i][1]);data[i][0]=data[i][0]*1e3}p_95th=percentile(inputs);for(i=0;i<data.length;i++){data_avg.push([data[i][0],p_95th.mean])}var points=[{data:data,color:"rgba(86, 175, 232, 1)",shadowSize:0,lines:{lineWidth:2,show:true,fill:false}},{data:data_avg,color:"rgba(244, 63, 32, .4)",shadowSize:0,dashes:{lineWidth:2,show:true,fill:false}}];var options={xaxis:{mode:"time",tickFormatter:tickFormatter},yaxis:{min:0,tickFormatter:function(value){if(value>999999){return value/1e6+"mm"}if(value>999){return value/1e3+"k"}return value}},tooltip:true,tooltipOpts:{content:function(label,xval,yval,flotItem){return yval+" events<br>"+moment(xval).format("llll")},defaultTheme:false},grid:{show:true,hoverable:true,backgroundColor:"#ffffff",borderColor:"#DEE3E9",borderWidth:2,tickColor:"#DEE3E9"},hoverable:false,legend:{noColumns:5},lines:{show:false}};$.plot($sparkline,points,options);$(window).resize(function(){$.plot($sparkline,points,options)})}})}}})();(function(){"use strict";app.collections={ScoredList:Backbone.Collection.extend({comparator:function(member){return-member.get("score")}})}})();(function(){"use strict";app.models={Group:Backbone.Model.extend({defaults:{count:0,version:0,annotations:[],tags:[],versions:[],hasSeen:false,isBookmarked:false,historicalData:[]}})}})();(function(){"use strict";var groupTemplate='<div class="event-details event-cell">   <div class="checkbox">       <input type="checkbox">   </div>   <h3><a href="<%= permalink %>"><%= title %></a></h3>   <div class="event-meta">       <% if (timeSpent) { %><time><%= Math.round(timeSpent) %>ms</time> &middot;<% } %>       <span class="message"><%= message %></span>       &middot; <time><%= firstSeen %></time>   </div> </div> <div class="event-assignee event-cell">   <div class="user-selector">     <div class="btn-group">       <a href="#" class="btn btn-sm btn-default dropdown-toggle">         <img src="http://github.com/benvinegar.png" class="avatar">         <span aria-hidden="true" class="icon-arrow-down"></span>       </a>       <ul class="dropdown-menu">         <li><a href="#"><img src="http://github.com/dcramer.png" class="avatar"> David Cramer</a></li>         <li><a href="#"><img src="http://github.com/ckj.png" class="avatar"> Chris Jennings</a></li>         <li><a href="#"><img src="http://github.com/mattrobenolt.png" class="avatar"> Matt Robenolt</a></li>         <li><a href="#"><img src="http://github.com/byk.png" class="avatar"> Red Lobster</a></li>       </ul>     </div>   </div> </div> <div class="hidden-sm hidden-xs event-graph align-right event-cell">     <span class="sparkline"></span> </div> <div class="hidden-xs event-occurrences align-center event-cell">   <span><%= utils.formatNumber(count) %></span> </div> <div class="hidden-xs event-users align-right event-cell">   <span>209</span> </div>';app.templates={group:groupTemplate}})();(function(){"use strict";var appConfig=window.SentryConfig;app.views={};app.views.GroupView=Backbone.View.extend({tagName:"li",className:"group",template:_.template(app.templates.group),initialize:function(){Backbone.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"updateCount","updateAllAnnotations","updateAnnotation","updateLastSeen","updateResolved","updateHasSeen","renderSparkline","updateBookmarked","render");this.model.on({"change:count":this.updateCount,"change:annotations":this.updateAllAnnotations,"change:lastSeen":this.updateLastSeen,"change:isBookmarked":this.updateBookmarked,"change:isResolved":this.updateResolved,"change:hasSeen":this.updateHasSeen,"change:historicalData":this.renderSparkline},this)},render:function(){var data=this.model.toJSON();data.projectUrl=appConfig.urlPrefix+"/"+appConfig.selectedTeam.slug+"/"+data.project.slug+"/";data.loggerUrl=data.projectUrl+"?logger="+data.logger;data.utils=app.utils;this.$el.html(this.template(data));this.$el.attr("data-id",this.model.id);this.$el.addClass(this.getLevelClassName());this.$el.find("a[data-action=resolve]").click(_.bind(function(e){e.preventDefault();if(this.model.get("isResolved")){this.unresolve()}else{this.resolve()}},this));this.$el.find("a[data-action=bookmark]").click(_.bind(function(e){e.preventDefault();this.bookmark()},this));this.updateLastSeen();this.renderSparkline();this.updateResolved();this.updateHasSeen();this.updateBookmarked()},updateBookmarked:function(){if(this.model.get("isBookmarked")){this.$el.find("a[data-action=bookmark]").addClass("checked")}else{this.$el.find("a[data-action=bookmark]").removeClass("checked")}},updateResolved:function(){if(this.model.get("isResolved")){this.$el.addClass("resolved")}else{this.$el.removeClass("resolved")}},updateHasSeen:function(){if(this.model.get("hasSeen")){this.$el.addClass("seen")}else{this.$el.removeClass("seen")}},renderSparkline:function(obj){var data=this.model.get("historicalData");if(!data||!data.length)return;this.$el.addClass("with-sparkline");app.charts.createSparkline(this.$el.find(".sparkline"),data)},resolve:function(){$.ajax({url:this.getResolveUrl(),type:"post",dataType:"json",success:_.bind(function(response){this.model.set("version",response.version+5e3);this.model.set("isResolved",true)},this)})},unresolve:function(){$.ajax({url:this.getUnresolveUrl(),type:"post",dataType:"json",success:_.bind(function(response){this.model.set("version",response.version+5e3);this.model.set("isResolved",false)},this)})},getResolveUrl:function(){return appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/"+appConfig.selectedProject.slug+"/group/"+this.model.get("id")+"/set/resolved/"},getUnresolveUrl:function(){return appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/"+appConfig.selectedProject.slug+"/group/"+this.model.get("id")+"/set/unresolved/"},getBookmarkUrl:function(){return appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/"+appConfig.selectedProject.slug+"/bookmark/"},bookmark:function(){$.ajax({url:this.getBookmarkUrl(),type:"post",dataType:"json",data:{gid:this.model.get("id")},success:_.bind(function(response){this.model.set("version",response.version);this.model.set("isBookmarked",response.isBookmarked)},this)})},getLevelClassName:function(){return"level-"+this.model.get("levelName")},updateLastSeen:function(){var dt=moment(this.model.get("lastSeen"));this.$el.find(".last-seen").text(dt.fromNow()).data("datetime",this.model.get("lastSeen")).attr("title",dt.format("llll"))},updateCount:function(){var new_count=app.utils.formatNumber(this.model.get("count"));var counter=this.$el.find(".count");var digit=counter.find("span");if(digit.is(":animated"))return false;if(counter.data("count")==new_count){return false}counter.data("count",new_count);var replacement=$("<span></span>",{css:{top:"-2.1em",opacity:0},text:new_count});digit.before(replacement).animate({top:"2.5em",opacity:0},"fast",function(){digit.remove()});replacement.delay(100).animate({top:0,opacity:1},"fast")},updateAnnotation:function(annotation){var value=annotation.count;if(value===null)return;var new_count=app.utils.formatNumber(value);var counter=this.$el.find('.annotation[data-tag="'+annotation.label+'"]');var digit=counter.find("span");if(digit.is(":animated"))return false;if(counter.data("count")==new_count){return false}counter.data("count",new_count);var replacement=$("<span></span>",{css:{top:"-2.1em",opacity:0},text:new_count});digit.before(replacement).animate({top:"2.5em",opacity:0},"fast",function(){digit.remove()});replacement.delay(100).animate({top:0,opacity:1},"fast")},updateAllAnnotations:function(){var self=this;$.each(this.model.get("annotations"),function(index,annotation){self.updateAnnotation(annotation)})}});app.views.OrderedElementsView=Backbone.View.extend({emptyMessage:'<div class="empty-message"><h2>No events to show.</h2><p>We\'ll notify you if that changes. In the meantime why not take a moment to become more familiar with Sentry.</p><p class="links"><a href="docs/">Installation instructions</a> <a href="settings/">Project settings</a></p></div>',loadingMessage:"<p>Loading...</p>",model:app.models.Group,defaults:{maxItems:50,view:Backbone.View},initialize:function(data){if(_.isUndefined(data))data={};var members=data.members;Backbone.View.prototype.initialize.apply(this,arguments);this.options=$.extend({},this.defaults,this.options,data);this.$wrapper=$("#"+this.id);this.$parent=$("<ul></ul>");this.$empty=$('<li class="empty"></li>');this.$wrapper.html(this.$parent);if(this.options.className)this.$parent.addClass(this.options.className);_.bindAll(this,"renderMemberInContainer","unrenderMember","reSortMembers");this.collection=new app.collections.ScoredList([],{model:data.model});this.collection.on("add",this.renderMemberInContainer,this);this.collection.on("remove",this.unrenderMember,this);this.collection.on("reset",this.reSortMembers,this);delete data.members;this.reset(members)},reset:function(members){this.$parent.empty();this.setEmpty();if(members===undefined){this.$empty.html(this.loadingMessage);this.collection.reset();this.setEmpty();this.loaded=false}else{this.$empty.html(this.emptyMessage);this.collection.reset(members);this.loaded=true}},setEmpty:function(){this.$parent.html(this.$empty)},extend:function(data){for(var i=0;i<data.length;i++){this.addMember(data[i])}},addMember:function(member){var existing=this.collection.get(member.id);if(!existing){if(this.collection.length>=this.options.maxItems){if(member.score<this.collection.last().get("score"))return;while(this.collection.length>=this.options.maxItems)this.collection.pop()}}else if(member.version&&existing.get("version")>=member.version){return}this.collection.add(member,{merge:true})},reSortMembers:function(){this.collection.each(_.bind(function(member){this.renderMemberInContainer(member)},this))},updateMember:function(member,options){if(_.isUndefined(options))options={};var existing=this.collection.get(member.id);if(existing.get("version")>=member.get("version"))return;this.collection.add(member,{merge:true,sort:options.sort!==false?true:false})},hasMember:function(member){return this.collection.get(member.id)?true:false},removeMember:function(member){this.collection.remove(member)},renderMemberInContainer:function(member){var new_pos=this.collection.indexOf(member),$el,$rel;this.$parent.find("li.empty").remove();$el=$("#"+this.id+member.id);if(!$el.length){$el=this.renderMember(member)}else if($el.index()===new_pos){return}if(new_pos===0){this.$parent.prepend($el)}else{$rel=$("#"+this.id+this.collection.at(new_pos).id);if(!$rel.length){this.$parent.append($el)}else if($el.id!==$rel.id){$el.insertBefore($rel)}else{return}}if(this.loaded)$el.addClass("new").delay(100).removeClass("new")},renderMember:function(member){var view=new this.options.view({model:member,id:this.id+member.id});view.render();return view.$el},unrenderMember:function(member){this.$parent.find("#"+this.id+member.id).remove();if(!this.$parent.find("li").length)this.setEmpty()}});app.views.GroupListView=app.views.OrderedElementsView.extend({defaults:{realtime:false,stream:false,pollUrl:null,pollTime:1e3,tickTime:100},initialize:function(data){if(_.isUndefined(data))data={};data.model=app.models.Group;data.view=app.views.GroupView;app.views.OrderedElementsView.prototype.initialize.call(this,data);this.options=$.extend({},this.defaults,this.options,data);this.queue=new app.collections.ScoredList([],{model:data.model});this.cursor=null;_.bindAll(this,"poll","pollSuccess","pollFailure","tick");this.poll();window.setInterval(this.tick,this.options.tickTime)},tick:function(){if(!this.queue.length)return;var item=this.queue.pop();if(this.options.canStream){this.addMember(item)}else if(this.hasMember(item)){this.updateMember(item,{sort:false})}},pollSuccess:function(groups){if(!groups.length)return window.setTimeout(this.poll,this.options.pollTime*5);this.cursor=groups[groups.length-1].score;this.queue.add(groups,{merge:true});window.setTimeout(this.poll,this.options.pollTime)},pollFailure:function(jqXHR,textStatus,errorThrown){window.setTimeout(this.poll,this.options.pollTime*10)},poll:function(){var data;if(!this.options.realtime||!this.options.pollUrl)return window.setTimeout(this.poll,this.options.pollTime);data=app.utils.getQueryParams();data.cursor=this.cursor||undefined;$.ajax({url:this.options.pollUrl,type:"GET",dataType:"json",data:data,success:this.pollSuccess,error:this.pollFailure})}})})();(function(){"use strict";var number_formats=[[1e9,"b"],[1e6,"m"],[1e3,"k"]];app.utils={getQueryParams:function(){var vars={},href=window.location.href,hashes,hash;if(href.indexOf("?")==-1)return vars;hashes=href.slice(href.indexOf("?")+1,href.indexOf("#")!=-1?href.indexOf("#"):href.length).split("&");$.each(hashes,function(_,chunk){hash=chunk.split("=");if(!hash[0]&&!hash[1])return;vars[decodeURIComponent(hash[0])]=hash[1]?decodeURIComponent(hash[1]).replace(/\+/," "):""});return vars},floatFormat:function(number,places){var multi=Math.pow(10,places);return parseInt(number*multi,10)/multi},formatNumber:function(number){var b,x,y,o,p;number=parseInt(number,10);for(var i=0;b=number_formats[i];i++){x=b[0];y=b[1];o=Math.floor(number/x);p=number%x;if(o>0){if(o/10>1||!p)return""+o+y;return""+this.floatFormat(number/x,1)+y}}return""+number},slugify:function(str){str=str.replace(/^\s+|\s+$/g,"");str=str.toLowerCase();var from="/_,:;";var to="aaaaeeeeiiiioooouuuunc------";for(var i=0,l=from.length;i<l;i++){str=str.replace(new RegExp(from.charAt(i),"g"),to.charAt(i))}str=str.replace(/[^a-z0-9\s\-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return str},varToggle:function(link,$elm){var $link=$(link);if(!$link.attr("data-expand-label"))$link.attr("data-expand-label",$link.html());$elm.toggle();if($elm.is(":visible"))$link.html($link.attr("data-collapse-label"));else $link.html($link.attr("data-expand-label"))},sortArray:function(arr,score_fn){arr.sort(function(a,b){var a_score=score_fn(a),b_score=score_fn(b);for(var i=0;i<a_score.length;i++){if(a_score[i]<b_score[i]){return 1}if(a_score[i]>b_score[i]){return-1}}return 0});return arr},escape:function(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},getSearchUsersUrl:function(){return appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/users/search/"},getSearchProjectsUrl:function(){return appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/projects/search/"},getSearchTagsUrl:function(){return appConfig.urlPrefix+"/api/"+appConfig.selectedTeam.slug+"/"+appConfig.selectedProject.slug+"/tags/search/"},makeSearchableInput:function(el,url,callback,options){$(el).selectize($.extend({create:true,maxItems:1,load:function(query,cb){$.ajax({url:url+"?limit=10&query="+encodeURIComponent(query),type:"GET",dataType:"json",error:function(){callback()},success:function(res){cb(callback(res))}})}},options||{}))},makeSearchableUsersInput:function(el){this.makeSearchableInput(el,this.getSearchUsersUrl(),_.bind(function(data){var results=[];$(data.results).each(_.bind(function(_,val){var label;if(val.first_name){label=this.escape(val.first_name)+" &mdash; "+this.escape(val.username)}else{label=this.escape(val.username)}label+="<br>"+this.escape(val.email);results.push({id:val.username,text:label})},this));if(data.query&&$(results).filter(function(){return this.id.localeCompare(data.query)===0}).length===0){results.push({id:this.escape(data.query),text:this.escape(data.query)})}return results}))}}})();
+//@ sourceMappingURL=legacy-app.min.map.js
\ No newline at end of file
diff --git a/src/sentry/static/sentry/main.js b/src/sentry/static/sentry/main.js
deleted file mode 100644
index 3ae19e7dd7..0000000000
--- a/src/sentry/static/sentry/main.js
+++ /dev/null
@@ -1,42 +0,0 @@
-define([
-  'angular',
-  'app',
-  'moment',
-  'jquery',
-
-  'app/controllers/default',
-  'app/controllers/deleteTeam',
-  'app/controllers/groupDetails',
-  'app/controllers/manageTeamOwnership',
-  'app/controllers/manageTeamSettings',
-  'app/controllers/projectStream',
-  'app/controllers/teamDashboard',
-
-  'app/directives/count',
-  'app/directives/timeSince',
-], function(angular, app, moment, jQuery){
-  'use strict';
-
-  app.config(function(
-    $httpProvider, $interpolateProvider, $provide
-  ) {
-    // compatiblity with Django templates
-    $interpolateProvider.startSymbol('<%');
-    $interpolateProvider.endSymbol('%>');
-
-    // add in Django csrf support
-    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
-    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
-
-    $provide.value('config', window.SentryConfig);
-    $provide.value('selectedTeam', window.SentryConfig.selectedTeam);
-    $provide.value('selectedProject', window.SentryConfig.selectedProject);
-  });
-
-  // Change all select boxes to selectize elements.
-  jQuery('select').selectize();
-
-  moment.lang(window.SentryConfig.lang);
-
-  angular.bootstrap(document, ['app']);
-});
diff --git a/src/sentry/static/sentry/styles/sentry.css b/src/sentry/static/sentry/styles/sentry.css
index 46a1d17eed..fe2c9c2e06 100644
--- a/src/sentry/static/sentry/styles/sentry.css
+++ b/src/sentry/static/sentry/styles/sentry.css
@@ -6761,6 +6761,9 @@ hr {
   margin: 20px 0;
   color: #999;
 }
+.container {
+  position: relative;
+}
 #content {
   margin-bottom: 40px;
 }
@@ -6815,8 +6818,12 @@ h3 {
 .back-button.icon-arrow-left {
   font-size: 48px !important;
   position: absolute;
-  left: -60px;
-  top: -1px;
+  left: -40px;
+  top: -10px;
+  color: rgba(70, 82, 98, 0.2);
+}
+.back-button.icon-arrow-left:hover {
+  color: rgba(70, 82, 98, 0.5);
 }
 .btn-sm .icon-arrow-down,
 .btn-sm .icon-arrow-right,
@@ -6896,7 +6903,8 @@ header .user-nav > li {
 header .user-nav > li a {
   font-size: 15px;
 }
-header .user-nav .icon-settings {
+header .user-nav .icon-settings,
+header .user-nav .icon-book {
   padding-right: 5px;
 }
 header .project-dropdown {
@@ -7081,7 +7089,6 @@ footer a:hover {
 .btn {
   border: 2px solid transparent;
   font-weight: 600;
-  color: inherit;
 }
 .btn:active {
   box-shadow: none;
@@ -7186,6 +7193,9 @@ footer a:hover {
   background: #2598e1;
   border-color: #1a7ebe;
 }
+.primary-filters {
+  padding-right: 0;
+}
 .filter-nav {
   margin-top: -5px;
   margin-bottom: 14px;
@@ -7359,9 +7369,16 @@ a.icon-share:hover {
 .stream-pagination {
   margin: 20px 0;
 }
+.stream-pagination .icon-arrow-right,
+.stream-pagination .icon-arrow-left {
+  font-size: 20px !important;
+}
 .stream-actions {
   display: table-row;
 }
+.stream-actions .btn-group > .btn {
+  color: inherit;
+}
 .stream-actions .checkbox {
   position: absolute;
   left: 16px;
@@ -7442,10 +7459,11 @@ fieldset[disabled] .stream-actions .realtime-paused.active {
   color: #d9534f;
   background-color: #ffffff;
 }
-.stream-actions .btn {
+.stream-actions > .btn {
+  color: inherit;
   background: rgba(255, 255, 255, 0.85);
 }
-.stream-actions .btn.dropdown-toggle {
+.stream-actions > .btn.dropdown-toggle {
   background: none;
 }
 .group-detail {
@@ -7476,46 +7494,9 @@ fieldset[disabled] .stream-actions .realtime-paused.active {
 .group-detail .users {
   color: #949ea4;
 }
-.group-detail .assigned-to .dropdown {
+.group-detail .assigned-to .btn-group {
+  margin-top: -3px;
   float: right;
-  margin-bottom: 2px;
-}
-.group-detail .assigned-to .dropdown:before,
-.group-detail .assigned-to .dropdown:after {
-  content: " ";
-  display: table;
-}
-.group-detail .assigned-to .dropdown:after {
-  clear: both;
-}
-.group-detail .assigned-to .dropdown:before,
-.group-detail .assigned-to .dropdown:after {
-  content: " ";
-  display: table;
-}
-.group-detail .assigned-to .dropdown:after {
-  clear: both;
-}
-.group-detail .assigned-to .avatar {
-  float: left;
-  width: auto;
-  height: auto;
-}
-.group-detail .assigned-to .avatar img {
-  border-radius: 3px 0 0 3px;
-  width: 28px;
-  height: 28px;
-  margin-bottom: 0px;
-  display: block;
-}
-.group-detail .assigned-to .btn {
-  float: left;
-  border-left: 0;
-  height: 28px;
-  margin-left: 0;
-  padding: 4px 6px 0;
-  border-radius: 0 4px 4px 0;
-  background: #fff;
 }
 .group-detail .meta {
   margin: 0 0 15px;
@@ -7575,6 +7556,11 @@ fieldset[disabled] .stream-actions .realtime-paused.active {
 .group-list .group,
 .events .group {
   display: table-row;
+  background: transparent;
+  -webkit-transition: all 2s linear;
+  transition: all 2s linear;
+  z-index: 1;
+  position: relative;
 }
 .group-list .group .event-details:after,
 .events .group .event-details:after {
@@ -7586,16 +7572,35 @@ fieldset[disabled] .stream-actions .realtime-paused.active {
   left: 0;
   width: 4px;
   background: #54adff;
+  z-index: 100;
 }
 .group-list .group.seen .event-details:after,
 .events .group.seen .event-details:after {
-  background: #fff;
+  background: transparent;
+}
+.group-list .group.new,
+.events .group.new {
+  background: #fffff4;
+}
+.group-list .group.new .event-cell,
+.events .group.new .event-cell {
+  border-color: #f7f7c7;
+}
+.group-list .group.new + .group .event-cell,
+.events .group.new + .group .event-cell {
+  border-color: #f7f7c7;
+}
+.group-list .group:first-child .event-cell,
+.events .group:first-child .event-cell {
+  border-top: 0;
 }
 .group-list .event-cell,
 .events .event-cell {
+  -webkit-transition: all 2s linear;
+  transition: all 2s linear;
   position: relative;
   display: table-cell;
-  border-bottom: 3px solid #F8F9FA;
+  border-top: 3px solid #F8F9FA;
   padding: 15px 0;
   vertical-align: middle;
 }
@@ -7660,7 +7665,7 @@ fieldset[disabled] .stream-actions .realtime-paused.active {
 }
 .group-list .event-assignee,
 .events .event-assignee {
-  width: 32px;
+  width: 40px;
   padding: 0 30px;
 }
 .group-list .event-graph,
@@ -7721,6 +7726,31 @@ fieldset[disabled] .stream-actions .realtime-paused.active {
 .events.similar-events .event-details {
   padding-left: 10px;
 }
+.user-selector .btn {
+  padding-left: 5px;
+  padding-right: 5px;
+  background: transparent;
+  border-radius: 4px;
+  border-color: transparent;
+  width: 50px;
+  color: rgba(70, 82, 98, 0.4) !important;
+}
+.user-selector .btn span {
+  top: 3px;
+}
+.user-selector .dropdown-menu {
+  left: auto;
+  right: 0;
+  max-height: 180px;
+  overflow: auto;
+}
+.user-selector .dropdown-menu li a {
+  padding-left: 8px;
+  padding-right: 8px;
+}
+.user-selector .dropdown-menu li a img {
+  margin-right: 5px;
+}
 .inactive .group-list > li:hover {
   filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
   background-image: none;
@@ -7807,7 +7837,7 @@ ul.traceback {
 }
 .traceback > .traceback {
   margin-top: 10px;
-  padding-bottom: 20px;
+  padding-bottom: 5px;
 }
 .subtraceback {
   padding-left: 15px;
@@ -7842,7 +7872,7 @@ ul.traceback {
 }
 .frame p {
   font-size: 12px;
-  margin-bottom: 0;
+  margin-bottom: 4px;
 }
 .frame p a.annotation {
   color: inherit;
@@ -7861,7 +7891,7 @@ ul.traceback {
   color: inherit;
 }
 .frame .context {
-  margin-bottom: 5px;
+  margin-bottom: 10px;
 }
 .frame .tag-app {
   color: #aaa;
@@ -7903,6 +7933,7 @@ ol.context {
   margin: 0;
   list-style-position: inside;
   border-radius: 3px;
+  padding-left: 0;
 }
 ol.context > li {
   padding-left: 20px;
@@ -8319,24 +8350,6 @@ legend {
   }
 }
 /* ////////////////////////////////// Flat overrides ////////////////////////////////// */
-.dashboard .page-header {
-  margin: 0;
-  border-bottom: 2px solid #eceff2;
-}
-.dashboard .page-header .nav {
-  margin: 0 0 14px;
-}
-.dashboard .page-header .nav a {
-  font-size: 11px;
-  color: #9ea7af;
-  font-weight: bold;
-  min-width: 50px;
-  text-align: center;
-}
-.dashboard .page-header .nav .active a {
-  color: #fff;
-  background: #56AFE8;
-}
 .dashboard .events.small {
   margin-bottom: 10px;
 }
@@ -8401,6 +8414,12 @@ li.empty {
 .empty-message p.links a {
   margin: 0 12px 0 0;
 }
+.box-header {
+  padding-bottom: 8px;
+}
+.box-header .nav {
+  margin-bottom: 0;
+}
 table.table td input,
 table.table td .select2-container {
   margin-bottom: 0;
@@ -8434,8 +8453,8 @@ table.table td .select2-container {
   color: #878e94;
 }
 .dropdown-menu li a:hover {
-  background: #fff;
-  color: #696f75;
+  background: #f1f2f3;
+  color: #61686d;
 }
 .dropdown-menu li.active a,
 .dropdown-menu li.active a:hover {
@@ -8750,16 +8769,6 @@ textarea.activity .post-box textarea {
   overflow: hidden;
   text-overflow: ellipsis;
 }
-.toggle-expand {
-  padding: 0 !important;
-}
-.toggle-expand a {
-  display: block;
-  text-align: center;
-  padding: 3px 5px;
-  font-size: 0.9em;
-  background: #dee3e9;
-}
 .narrow .container {
   max-width: 800px;
 }
diff --git a/src/sentry/templates/sentry/dashboard.html b/src/sentry/templates/sentry/dashboard.html
index ed2232cc95..7761701847 100644
--- a/src/sentry/templates/sentry/dashboard.html
+++ b/src/sentry/templates/sentry/dashboard.html
@@ -70,15 +70,11 @@
             </div>
         {% endblock %}
     </div>
-{% endblock %}
 
-{% block content_after %}
     <script type="text/javascript">
-    require(['config', 'app/init'], function(_, app){
         new app.DashboardPage({
             realtime: false,
             stream: false
         });
-    });
     </script>
 {% endblock %}
diff --git a/src/sentry/templates/sentry/groups/details.html b/src/sentry/templates/sentry/groups/details.html
index 94e0de1ae4..83af23bcff 100644
--- a/src/sentry/templates/sentry/groups/details.html
+++ b/src/sentry/templates/sentry/groups/details.html
@@ -231,10 +231,9 @@
 {% block content_after %}
     <script>
     window.SentryConfig.selectedGroup = {% convert_to_json selectedGroup %};
-    require(['config', 'app/init'], function(_, app){
-        new app.GroupDetailsPage({
-            group: {{ group|to_json:request|safe }},
-        });
+
+    new app.GroupDetailsPage({
+        group: {{ group|to_json:request|safe }},
     });
     </script>
 {% endblock %}
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index d3c46c8efc..968f0eb4c7 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -134,12 +134,10 @@
     </div>
 
     <script>
-    require(['config', 'app/init'], function(_, app){
-        new app.StreamPage({
-            groups: {{ event_list|to_json:request|safe }},
-            canStream: {{ has_realtime|to_json|safe }},
-            realtime: true
-        });
+    new app.StreamPage({
+        groups: {{ event_list|to_json:request|safe }},
+        canStream: {{ has_realtime|to_json|safe }},
+        realtime: true
     });
     </script>
 {% endblock %}
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index eb3938b6bd..b3f60f437d 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -24,6 +24,13 @@
         <![endif]-->
         {% block scripts %}
             <script>
+            // Legacy app object
+            window.app = {
+                config: {},
+                templates: {},
+                utils: {}
+            }
+
             window.SentryConfig = {};
             window.SentryConfig.popupCss = '{% url 'sentry-media' "sentry" 'styles/popup.css' %}';
             window.SentryConfig.mediaUrl = '{% url 'sentry-media' "sentry" '' %}';
@@ -41,9 +48,22 @@
             {% endif %}
             </script>
 
-            <script src="{% url 'sentry-media' 'sentry' 'config.js' %}"></script>
-            <script data-main="{% url 'sentry-media' 'sentry' 'main' %}"
-                    src="{% url 'sentry-media' 'sentry' 'vendor/requirejs/require.js' %}"></script>
+            {% staticbundle 'sentry/vendor-angular.min.js' %}
+            {% staticbundle 'sentry/vendor-jquery.min.js' %}
+            {% staticbundle 'sentry/vendor-bootstrap.min.js' %}
+            {% staticbundle 'sentry/vendor-misc.min.js' %}
+
+            {% staticbundle 'sentry/app.min.js' %}
+            {% staticbundle 'sentry/legacy-app.min.js' %}
+
+            <script>
+            jQuery('select').selectize();
+
+            moment.lang(window.SentryConfig.lang);
+
+            angular.bootstrap(document, ['app']);
+            </script>
+
             <script src="{% url 'sentry-media' 'sentry' 'vendor/raven/raven.js' %}"></script>
         {% endblock %}
 
diff --git a/src/sentry/templates/sentry/select_team.html b/src/sentry/templates/sentry/select_team.html
index 4c61e07b49..139378da08 100644
--- a/src/sentry/templates/sentry/select_team.html
+++ b/src/sentry/templates/sentry/select_team.html
@@ -44,8 +44,6 @@
     </section>
 
     <script>
-    require(['config', 'app/init'], function(_, app){
-        new app.SelectTeamPage();
-    });
+    new app.SelectTeamPage();
     </script>
 {% endblock %}
